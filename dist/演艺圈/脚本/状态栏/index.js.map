{"version":3,"file":"index.js","mappings":"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","sources":["src://tavern_helper_template/external var \"z\"","src://tavern_helper_template/src/æ¼”è‰ºåœˆ/schema.ts","src://tavern_helper_template/src/æ¼”è‰ºåœˆ/è„šæœ¬/çŠ¶æ€æ /index.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = z;","export const Schema = z.object({\n    // --- ä¸–ç•Œç¯å¢ƒ ---\n    ä¸–ç•Œ: z.object({\n        å½“å‰æ—¥æœŸ: z.string().prefault('å¾…å®š'),\n        å½“å‰åœ°ç‚¹: z.string().prefault('å¾…å®š'),\n        æ—¶ä»£æ–°é—»: z.string().prefault('å¾…å®š'),\n        è¡Œä¸šæ–°é—»: z.string().prefault('å¾…å®š'),\n        å…«å¦æ–°é—»: z.string().prefault('å¾…å®š'),\n    }),\n    // --- ä¸»è§’æ¡£æ¡ˆ ---\n    ä¸»è§’: z.object({\n        å§“å: z.string().prefault('å¾…å®š'),\n        æ€§åˆ«: z.string().prefault('å¾…å®š'),\n        å›½ç±: z.string().prefault('å¾…å®š'),\n        ç”Ÿæ—¥: z.string().prefault('å¾…å®š'),\n        _å¹´é¾„: z.coerce.number().prefault(0),\n        å¤–è²Œ: z.string().prefault('å¾…å®š'),\n        èŒä¸š: z.string().prefault('å¾…å®š'),\n        æ€§ç™–: z.string().prefault('æ— '),\n        é…å¶: z.string().prefault('æ— '),\n        å­å¥³: z.string().prefault('æ— '),\n        æƒ…äºº: z.string().prefault('æ— '),\n    }),\n    // --- èŒä¸šå±¥å† ---\n    èŒä¸šå±¥å†: z.object({\n        ä½œå“å: z.array(z.string()).prefault([]),\n        è·å–å¥–é¡¹: z.array(z.string()).prefault([]),\n    }),\n    // --- è¡Œä¸šè¯„ä¼° ---\n    ä¸“ä¸šè¯„ä¼°: z.object({\n        å½“å‰å’–ä½: z.string().prefault('æ— '),\n        ä¸šåŠ¡èƒ½åŠ›: z.string().prefault('æ— '),\n        åª’ä½“é£å‘: z.string().prefault('æ— '),\n        ç¤¾ä¼šé£è¯„: z.string().prefault('æ— '),\n        ç²‰ä¸åŸºç¡€: z.string().prefault('æ— '),\n    }),\n    //--- ä¸ªäººè´¦æˆ· ---\n    ä¸ªäººè´¦æˆ·: z\n        .object({\n        ç°é‡‘: z.coerce.number().prefault(0),\n        åˆçº¦çŠ¶æ€: z.string().prefault('æ— '),\n        // ä¿®æ­£ï¼šèµ„äº§é‡åŒ–\n        æŒæœ‰èµ„äº§: z\n            .record(z.string(), z.object({\n            æ•°é‡: z.coerce.number().prefault(0),\n        }))\n            .prefault({})\n            .describe('Key:èµ„äº§åç§°'),\n    })\n        .prefault({}),\n    //--- å…¬å¸è´¦æˆ· ---\n    å…¬å¸è´¦æˆ·: z\n        .object({\n        // è¿è¡Œé¡¹ç›®ï¼šè®°å½•å…¬å¸æ­£åœ¨è¿è¥çš„ä¸šåŠ¡çº¿/äº§å“çº¿ï¼Œç”¨äºè®¡ç®—ç»è¥æ€§æ”¶å…¥ï¼ˆæœˆæ¯›åˆ©ç”±è„šæœ¬è®¡ç®—ï¼‰\n        è¿è¡Œé¡¹ç›®: z\n            .record(z.string().describe('ä¸šåŠ¡çº¿åç§°'), z.object({\n            æœˆé”€é‡: z.coerce.number().prefault(0).describe('æœˆé”€é‡/æœˆæ´»'),\n            å•ä»·: z.coerce.number().prefault(0).describe('å•ä»·/ARPU'),\n            è¾¹é™…æˆæœ¬ç‡: z.coerce\n                .number()\n                .transform(v => _.clamp(v, 0, 1))\n                .prefault(0.5),\n            _æœˆæ¯›åˆ©: z.coerce.number().prefault(0).describe('ç”±è„šæœ¬è®¡ç®—ï¼šæœˆé”€é‡ * å•ä»· * (1 - è¾¹é™…æˆæœ¬ç‡)'),\n        }))\n            .prefault({})\n            .describe('å…¬å¸æ­£åœ¨è¿è¥çš„ä¸šåŠ¡çº¿/äº§å“çº¿ï¼Œç”¨äºè®¡ç®—ç»è¥æ€§æ”¶å…¥'),\n        å›ºå®šæˆæœ¬: z\n            .object({\n            äººåŠ›æˆæœ¬: z.coerce.number().prefault(0),\n            æˆ¿ç§Ÿ: z.coerce.number().prefault(0),\n        })\n            .prefault({}),\n        å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨: z.coerce\n            .number()\n            .prefault(0)\n            .describe('éç»è¥æ€§èµ„é‡‘æµåŠ¨ï¼Œä¸»è¥ä¸šåŠ¡æ”¶å…¥ä¸è®¡å…¥ï¼ˆæ­£æ•°=æ”¶å…¥ï¼Œè´Ÿæ•°=æ”¯å‡ºï¼‰'),\n        _ç°é‡‘: z.coerce.number().prefault(0),\n    })\n        .prefault({}),\n    // --- ç¤¾äº¤ç½‘ç»œ ---\n    äººè„‰: z.object({\n        ç¤¾äº¤ç‰ˆå›¾: z.array(z.string()).prefault(['æ— ']),\n        è¿‘æœŸäº’åŠ¨: z.array(z.string()).describe('æœ€è¿‘æœ‰è¿‡å…³é”®äº¤äº’çš„äºº').prefault(['æ— ']),\n        å…³ç³»ç°¿: z.record(z.string(), z.coerce.number()).prefault({}),\n    }),\n    // --- ç‰¹æ®Šæœºåˆ¶ ---\n    è´è¶æ•ˆåº”: z.object({\n        å·²æŠ¹é™¤åˆ—è¡¨: z.record(z.string(), z.string().describe('åŸä½œè€…')).prefault({}),\n    }),\n});\n","import { waitUntil } from 'async-wait-until';\nimport { Schema } from '../../schema';\n\n/**\n * è§£ææ—¥æœŸå­—ç¬¦ä¸²ï¼Œæå– YYYY-MM-DD éƒ¨åˆ†\n * æ”¯æŒæ ¼å¼ï¼šYYYY-MM-DD å‘¨X HH:mm æˆ– YYYY-MM-DD\n */\nfunction parseDate(dateStr: string): Date | null {\n  if (!dateStr || dateStr === 'å¾…å®š') {\n    return null;\n  }\n  // æå– YYYY-MM-DD éƒ¨åˆ†ï¼ˆå¯èƒ½åŒ…å«æ—¶é—´ï¼‰\n  const match = dateStr.match(/(\\d{4})-(\\d{2})-(\\d{2})/);\n  if (!match) {\n    return null;\n  }\n  const year = parseInt(match[1], 10);\n  const month = parseInt(match[2], 10) - 1; // JavaScript Date æœˆä»½ä» 0 å¼€å§‹\n  const day = parseInt(match[3], 10);\n  return new Date(year, month, day);\n}\n\n/**\n * è®¡ç®—è·¨æœˆæ•°ï¼šä»ä¸Šä¸€è½®æ—¥æœŸåˆ°æœ¬è½®æ—¥æœŸï¼Œç»è¿‡äº†å¤šå°‘ä¸ª\"1æ—¥\"èŠ‚ç‚¹\n * ä¾‹å¦‚ï¼š2002-07-15 åˆ° 2002-09-15ï¼Œè·¨äº†2ä¸ªæœˆï¼ˆç»è¿‡8æœˆ1æ—¥å’Œ9æœˆ1æ—¥ï¼‰\n * è·¨è¶ŠèŠ‚ç‚¹å®šä¸ºæ¯æœˆçš„1æ—¥\n */\nfunction calculateMonthCrossing(oldDateStr: string, newDateStr: string): number {\n  const oldDate = parseDate(oldDateStr);\n  const newDate = parseDate(newDateStr);\n\n  if (!oldDate || !newDate) {\n    return 0;\n  }\n\n  // å¦‚æœæ–°æ—¥æœŸæ—©äºæˆ–ç­‰äºæ—§æ—¥æœŸï¼Œè¿”å›0\n  if (newDate <= oldDate) {\n    return 0;\n  }\n\n  // è·å–æ—§æ—¥æœŸçš„å¹´æœˆæ—¥\n  const oldYear = oldDate.getFullYear();\n  const oldMonth = oldDate.getMonth(); // 0-11\n  const oldDay = oldDate.getDate();\n\n  // è·å–æ–°æ—¥æœŸçš„å¹´æœˆæ—¥\n  const newYear = newDate.getFullYear();\n  const newMonth = newDate.getMonth();\n\n  // è®¡ç®—ä»æ—§æ—¥æœŸä¹‹åçš„ä¸‹ä¸€ä¸ª\"1æ—¥\"å¼€å§‹ï¼Œåˆ°æ–°æ—¥æœŸä¹‹é—´ç»è¿‡äº†å¤šå°‘ä¸ª\"1æ—¥\"\n  let currentYear = oldYear;\n  let currentMonth = oldMonth;\n\n  // å¦‚æœæ—§æ—¥æœŸä¸æ˜¯1æ—¥ï¼Œä»ä¸‹ä¸ªæœˆçš„1æ—¥å¼€å§‹è®¡ç®—\n  // ä¸‹ä¸ªæœˆçš„1æ—¥æœ¬èº«å°±æ˜¯ä¸€ä¸ªè·¨æœˆèŠ‚ç‚¹ï¼Œåº”è¯¥è¢«è®¡ç®—åœ¨å†…\n  if (oldDay > 1) {\n    currentMonth++;\n    if (currentMonth > 11) {\n      currentMonth = 0;\n      currentYear++;\n    }\n  }\n\n  let monthCount = 0;\n\n  // ä»ä¸‹ä¸€ä¸ª\"1æ—¥\"å¼€å§‹ï¼Œé€æœˆæ£€æŸ¥æ˜¯å¦ç»è¿‡äº†\"1æ—¥\"èŠ‚ç‚¹\n  while (true) {\n    // æ£€æŸ¥å½“å‰æœˆä»½æ˜¯å¦åœ¨æ–°æ—¥æœŸä¹‹å‰æˆ–ç­‰äºæ–°æ—¥æœŸæ‰€åœ¨æœˆä»½\n    if (currentYear > newYear || (currentYear === newYear && currentMonth > newMonth)) {\n      break;\n    }\n\n    // å¦‚æœå½“å‰æœˆä»½ç­‰äºæ–°æ—¥æœŸæ‰€åœ¨æœˆä»½\n    if (currentYear === newYear && currentMonth === newMonth) {\n      // å¦‚æœæ–°æ—¥æœŸæ˜¯1æ—¥ï¼Œç®—è·¨æœˆï¼›å¦‚æœæ–°æ—¥æœŸä¸æ˜¯1æ—¥ï¼Œä½†å½“å‰æœˆä»½æ˜¯ç»è¿‡çš„\"1æ—¥\"èŠ‚ç‚¹ï¼Œä¹Ÿç®—è·¨æœˆ\n      // å› ä¸ºä»æ—§æ—¥æœŸåˆ°æ–°æ—¥æœŸï¼Œç»è¿‡äº†å½“å‰æœˆä»½çš„1æ—¥è¿™ä¸ªèŠ‚ç‚¹\n      monthCount++;\n      break;\n    }\n\n    // ç»è¿‡äº†ä¸€ä¸ª\"1æ—¥\"èŠ‚ç‚¹\n    monthCount++;\n\n    // ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæœˆ\n    currentMonth++;\n    if (currentMonth > 11) {\n      currentMonth = 0;\n      currentYear++;\n    }\n  }\n\n  return monthCount;\n}\n\n/**\n * è®¡ç®—å…¬å¸è´¦æˆ·ç°é‡‘\n * è·¨æœˆæ•°ä¸º0ï¼š_ç°é‡‘ = ä¸Šä¸€è½®_ç°é‡‘ + æœ€æ–°å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨\n * è·¨æœˆæ•°>=1ï¼š_ç°é‡‘ = ä¸Šä¸€è½®_ç°é‡‘ + æœ€æ–°å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨ - å›ºå®šæˆæœ¬(ä¸Šä¸€è½®) * è·¨æœˆæ•° + æ‰€æœ‰è¿è¡Œé¡¹ç›®æœˆæ¯›åˆ©(ä¸Šä¸€è½®) * è·¨æœˆæ•°\n */\nfunction calculateCompanyCash(\n  oldCash: number,\n  oneTimeChange: number,\n  monthCrossing: number,\n  oldFixedCosts: any,\n  oldRunningProjects: any,\n): number {\n  let cash = Number(oldCash) || 0;\n  const change = Number(oneTimeChange) || 0;\n\n  // åŠ ä¸Šä¸€æ¬¡æ€§å˜åŠ¨\n  cash += change;\n\n  // å¦‚æœè·¨æœˆï¼Œéœ€è¦æ‰£é™¤å›ºå®šæˆæœ¬ï¼ŒåŠ ä¸Šè¿è¡Œé¡¹ç›®çš„æœˆæ¯›åˆ©\n  if (monthCrossing >= 1) {\n    // è®¡ç®—å›ºå®šæˆæœ¬ï¼ˆäººåŠ›æˆæœ¬ + æˆ¿ç§Ÿï¼‰\n    const humanCost = Number(_.get(oldFixedCosts, 'äººåŠ›æˆæœ¬')) || 0;\n    const rentCost = Number(_.get(oldFixedCosts, 'æˆ¿ç§Ÿ')) || 0;\n    const totalFixedCost = humanCost + rentCost;\n\n    // è®¡ç®—æ‰€æœ‰è¿è¡Œé¡¹ç›®çš„æœˆæ¯›åˆ©æ€»å’Œ\n    let totalMonthlyProfit = 0;\n    if (oldRunningProjects && typeof oldRunningProjects === 'object') {\n      for (const project_name in oldRunningProjects) {\n        const project = oldRunningProjects[project_name];\n        if (project && typeof project === 'object' && '_æœˆæ¯›åˆ©' in project) {\n          const monthlyProfit = Number(project._æœˆæ¯›åˆ©) || 0;\n          totalMonthlyProfit += monthlyProfit;\n        }\n      }\n    }\n\n    // æ‰£é™¤å›ºå®šæˆæœ¬ï¼ŒåŠ ä¸Šæœˆæ¯›åˆ©ï¼ˆä¹˜ä»¥è·¨æœˆæ•°ï¼‰\n    cash -= totalFixedCost * monthCrossing;\n    cash += totalMonthlyProfit * monthCrossing;\n  }\n\n  return cash;\n}\n\n$('#fate-phone-container, #fate-phone-css').remove();\nif (!window.fateAudioInstance) {\n  window.fateAudioInstance = new Audio(\n    'https://musify.club/track/pl/4437680/tomoyasu-hotei-battle-without-honor-or-humanity.mp3',\n  );\n  window.fateAudioInstance.loop = true;\n  window.fateAudioInstance.volume = 0.4;\n}\n$(document).off('.fatephone');\n\nwindow.FATE_CONFIG = {\n  storagePosIndex: 'fate_phone_pos_index_v9',\n  storageCollapse: 'fate_phone_collapsed',\n  storageTab: 'fate_phone_tab',\n};\n\nconst POSITIONS = [\n  { name: 'TL', css: { top: '60px', left: '10px', bottom: 'auto', right: 'auto' } },\n  { name: 'TR', css: { top: '60px', right: '10px', bottom: 'auto', left: 'auto' } },\n  { name: 'BR', css: { bottom: '20px', right: '10px', top: 'auto', left: 'auto' } },\n  { name: 'BL', css: { bottom: '20px', left: '10px', top: 'auto', right: 'auto' } },\n];\n\nconst fateState = {\n  currentTab: localStorage.getItem(window.FATE_CONFIG.storageTab) || 'home',\n  isBgmOn: false,\n  isCollapsed: localStorage.getItem(window.FATE_CONFIG.storageCollapse) === 'true',\n  posIndex: parseInt(localStorage.getItem(window.FATE_CONFIG.storagePosIndex)) || 0,\n};\n\nconst fateStyles = `\n<style id=\"fate-phone-css\">\n    @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap');\n    #fate-phone-container {\n        --phone-w: 95vw;\n        --max-w: 350px;\n        --phone-h: 80vh;\n        --max-h: 680px;\n        --bezel: 12px; --radius: 24px;\n        --c-frame: #111; --c-bg: #050505; --c-card: rgba(255,255,255,0.08); --c-text: #eee; --c-sub: #888;\n\n        position: fixed;\n        width: var(--phone-w); max-width: var(--max-w);\n        height: var(--phone-h); max-height: var(--max-h);\n\n        background: var(--c-frame); border-radius: var(--radius);\n        box-shadow: 0 0 0 2px #000, 0 0 0 4px #333, 0 20px 50px rgba(0,0,0,0.6);\n        z-index: 500; font-family: 'Noto Sans SC', sans-serif; color: var(--c-text);\n        user-select: none; transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);\n    }\n    #fate-phone-container.collapsed {\n        width: 50px; height: 50px;\n        border-radius: 14px; border: 2px solid #555;\n        min-width: 0; min-height: 0;\n        overflow: hidden;\n    }\n    .icon-placeholder { display: none; width: 100%; height: 100%; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; background: #000; }\n    #fate-phone-container.collapsed .icon-placeholder { display: flex; }\n    #fate-phone-container.collapsed .screen-area { display: none; }\n    .screen-area { position: absolute; top: var(--bezel); left: var(--bezel); right: var(--bezel); bottom: var(--bezel); background: linear-gradient(170deg, #1a1a1a 0%, #000 100%); border-radius: calc(var(--radius) - 4px); overflow: hidden; display: flex; flex-direction: column; pointer-events: auto; }\n    .status-bar { height: 24px; min-height: 24px; display: flex; align-items: center; justify-content: space-between; padding: 0 12px; font-size: 10px; z-index: 20; background: rgba(0,0,0,0.3); }\n    #fp-clock { cursor: pointer; font-weight: 700; color: #ddd; opacity: 0.8; transition: 0.2s; }\n    #fp-clock:hover { opacity: 1; color: #fff; }\n    .header-info { padding: 8px 15px 10px 15px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.08); background: rgba(0,0,0,0.2); }\n    .main-title { font-size: 16px; font-weight: 900; color: #fff; margin-bottom: 2px; letter-spacing: 1px; }\n    .sub-quote { font-size: 9px; color: #666; font-style: italic; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; opacity: 0.7; }\n    .scroll-content { flex: 1; overflow-y: auto; padding: 10px; scrollbar-width: none; cursor: grab; -webkit-overflow-scrolling: touch; }\n    .scroll-content.grabbing { cursor: grabbing; }\n    .scroll-content::-webkit-scrollbar { display: none; }\n    .nav-bar { height: 50px; min-height: 50px; background: rgba(15,15,15,0.98); border-top: 1px solid rgba(255,255,255,0.08); display: flex; justify-content: space-around; align-items: center; padding-bottom: 2px; }\n    .nav-item { flex: 1; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 9px; color: #444; cursor: pointer; transition: 0.2s; }\n    .nav-item:hover { color: #888; background: rgba(255,255,255,0.02); }\n    .nav-item.active { color: #ddd; font-weight: 700; }\n    .nav-icon { font-size: 16px; margin-bottom: 2px; filter: grayscale(1); opacity: 0.5; transition: 0.2s; }\n    .nav-item.active .nav-icon { filter: grayscale(0); opacity: 1; }\n    .card { background: var(--c-card); border-radius: 8px; padding: 10px; margin-bottom: 10px; }\n    .card-title { font-size: 9px; color: #666; text-transform: uppercase; margin-bottom: 6px; font-weight: 700; letter-spacing: 1px; display: flex; align-items: center; gap: 6px; }\n    .card-title::before { content:''; display:block; width:3px; height:8px; background:#444; }\n    .info-row { display: flex; justify-content: space-between; align-items: center; padding: 3px 0; font-size: 11px; border-bottom: 1px solid rgba(255,255,255,0.03); }\n    .info-row:last-child { border-bottom: none; }\n    .info-key { color: #888; }\n    .info-val { color: #eee; font-weight: 500; text-align: right; }\n    .info-block { margin-top: 6px; padding: 6px; background: rgba(0,0,0,0.3); border-radius: 6px; font-size: 11px; color: #ccc; line-height: 1.4; }\n    .btn-icon { cursor: pointer; padding: 4px; opacity: 0.6; transition: 0.2s; font-size: 12px; }\n    .btn-icon:hover { opacity: 1; }\n    .list-item { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.03); font-size: 11px; display: flex; justify-content: space-between; }\n    .list-item:last-child { border-bottom: none; }\n    .hl-val { color: #fff; font-weight: 600; }\n    .dim-val { color: #666; font-size: 10px; }\n    .project-actions { display: flex; gap: 6px; align-items: center; }\n    .btn-small { cursor: pointer; padding: 2px 6px; font-size: 9px; background: rgba(255,255,255,0.1); border-radius: 4px; transition: 0.2s; }\n    .btn-small:hover { background: rgba(255,255,255,0.2); }\n    .btn-add { cursor: pointer; padding: 6px 12px; font-size: 10px; background: rgba(74,169,74,0.3); border-radius: 6px; text-align: center; margin-top: 8px; transition: 0.2s; }\n    .btn-add:hover { background: rgba(74,169,74,0.5); }\n    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; display: none; align-items: center; justify-content: center; }\n    .modal-overlay.show { display: flex; }\n    .modal-content { background: #1a1a1a; border-radius: 12px; padding: 20px; max-width: 400px; width: 90%; border: 1px solid rgba(255,255,255,0.1); }\n    .modal-title { font-size: 14px; font-weight: 700; color: #fff; margin-bottom: 15px; }\n    .form-group { margin-bottom: 12px; }\n    .form-label { font-size: 10px; color: #888; margin-bottom: 4px; display: block; }\n    .form-input { width: 100%; padding: 8px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 11px; box-sizing: border-box; }\n    .form-input:focus { outline: none; border-color: rgba(74,169,74,0.5); }\n    .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px; }\n    .btn-modal { padding: 8px 16px; border-radius: 6px; font-size: 11px; cursor: pointer; transition: 0.2s; border: none; }\n    .btn-modal-primary { background: rgba(74,169,74,0.5); color: #fff; }\n    .btn-modal-primary:hover { background: rgba(74,169,74,0.7); }\n    .btn-modal-secondary { background: rgba(255,255,255,0.1); color: #ccc; }\n    .btn-modal-secondary:hover { background: rgba(255,255,255,0.2); }\n</style>\n`;\n\nconst fateTemplate = `\n<div id=\"fate-phone-container\">\n    <div class=\"icon-placeholder\">ğŸ“±</div>\n    <div class=\"screen-area\">\n        <div class=\"status-bar\">\n            <span id=\"fp-clock\">12:00</span>\n            <div style=\"display:flex; gap:10px;\">\n                <div id=\"btn-bgm\" class=\"btn-icon\">ğŸ”‡</div>\n                <div id=\"btn-collapse\" class=\"btn-icon\">â–¼</div>\n            </div>\n        </div>\n        <div class=\"header-info\">\n            <div id=\"fp-title\" class=\"main-title\">é€æ¢¦æ¼”è‰ºåœˆ</div>\n            <div id=\"fp-quote\" class=\"sub-quote\">...</div>\n        </div>\n        <div id=\"fp-content\" class=\"scroll-content\"></div>\n        <div class=\"nav-bar\">\n            <div class=\"nav-item\" data-tab=\"home\"><div class=\"nav-icon\">ğŸ‘¤</div><div>æ¡£æ¡ˆ</div></div>\n            <div class=\"nav-item\" data-tab=\"business\"><div class=\"nav-icon\">ğŸ’¼</div><div>å•†ä¸š</div></div>\n            <div class=\"nav-item\" data-tab=\"social\"><div class=\"nav-icon\">ğŸ•¸ï¸</div><div>äººè„‰</div></div>\n            <div class=\"nav-item\" data-tab=\"world\"><div class=\"nav-icon\">ğŸ‘ï¸</div><div>æƒ…æŠ¥</div></div>\n        </div>\n    </div>\n</div>\n`;\n\nfunction getMvuDataSafe() {\n  try {\n    if (window.Mvu && typeof window.Mvu.getMvuData === 'function') {\n      const variables = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n      if (variables && variables.stat_data) {\n        return Schema.parse(variables.stat_data);\n      }\n    }\n  } catch (e) {\n    console.warn('è·å– MVU æ•°æ®å¤±è´¥:', e);\n  }\n  return Schema.parse({});\n}\n\nconst getVal = (data: z.infer<typeof Schema>, path: string, def: any = 'æ— ') => {\n  if (!data) return def;\n  let current: any = data;\n  try {\n    const keys = path.split('.');\n    for (const key of keys) {\n      if (current === undefined || current === null) return def;\n      current = current[key];\n    }\n    return current !== undefined && current !== null && current !== '' ? current : def;\n  } catch (e) {\n    return def;\n  }\n};\n\nconst renderModules = {\n  home: (sd: z.infer<typeof Schema>) => {\n    const name = getVal(sd, 'ä¸»è§’.å§“å', 'æœªçŸ¥');\n    const age = getVal(sd, 'ä¸»è§’._å¹´é¾„', 0);\n    const ageStr = age > 0 ? `${age}å²` : 'æœªçŸ¥';\n    const job = getVal(sd, 'ä¸»è§’.èŒä¸š', 'å¾…å®š');\n    const partner = getVal(sd, 'ä¸»è§’.é…å¶', 'æ— ');\n    const lover = getVal(sd, 'ä¸»è§’.æƒ…äºº', 'æ— ');\n    const child = getVal(sd, 'ä¸»è§’.å­å¥³', 'æ— ');\n    const cash = getVal(sd, 'ä¸ªäººè´¦æˆ·.ç°é‡‘', 0);\n    const contract = getVal(sd, 'ä¸ªäººè´¦æˆ·.åˆçº¦çŠ¶æ€', 'æ— ');\n    const assets = getVal(sd, 'ä¸ªäººè´¦æˆ·.æŒæœ‰èµ„äº§', {});\n    const assetsList: string =\n      typeof assets === 'object' && assets !== null\n        ? Object.keys(assets)\n            .map(key => {\n              const item = assets[key];\n              const count = typeof item === 'object' && item !== null && 'æ•°é‡' in item ? item.æ•°é‡ : 0;\n              return count > 0 ? `${key}Ã—${count}` : null;\n            })\n            .filter(Boolean)\n            .join('ã€') || 'æ— '\n        : 'æ— ';\n\n    // ä½œå“å’Œè£èª‰è®°å½•\n    const works = getVal(sd, 'èŒä¸šå±¥å†.ä½œå“å', []);\n    const awards = getVal(sd, 'èŒä¸šå±¥å†.è·å–å¥–é¡¹', []);\n    const renderList = (arr: string[]) => {\n      if (!Array.isArray(arr) || arr.length === 0) {\n        return `<div style=\"font-size:10px; color:#555; padding:4px;\">æš‚æ— è®°å½•</div>`;\n      }\n      return arr.map(item => `<div class=\"list-item\"><span class=\"hl-val\">${item}</span></div>`).join('');\n    };\n\n    return `\n        <div class=\"card\" style=\"display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.1);\">\n            <div style=\"font-size:16px; font-weight:700; color:#fff;\">${name}</div>\n            <div style=\"font-size:11px; color:#aaa;\">${ageStr}</div>\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">ç¤¾ä¼šå…³ç³»</div>\n            <div class=\"info-row\"><span class=\"info-key\">èŒä¸š</span><span class=\"info-val\">${job}</span></div>\n            <div class=\"info-row\"><span class=\"info-key\">é…å¶</span><span class=\"info-val\">${partner}</span></div>\n            <div class=\"info-row\"><span class=\"info-key\">æƒ…äºº</span><span class=\"info-val\">${lover}</span></div>\n            <div class=\"info-row\"><span class=\"info-key\">å­å¥³</span><span class=\"info-val\">${child}</span></div>\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">ä¸ªäººçŠ¶å†µ</div>\n            <div class=\"info-row\"><span class=\"info-key\">ç°é‡‘</span><span class=\"info-val\" style=\"color:#ddd; font-weight:700;\">Â¥${cash.toLocaleString()}</span></div>\n            <div class=\"info-row\"><span class=\"info-key\">åˆçº¦çŠ¶æ€</span><span class=\"info-val\">${contract}</span></div>\n            <div class=\"info-row\"><span class=\"info-key\">æŒæœ‰èµ„äº§</span><span class=\"info-val\" style=\"font-size:10px; max-width:140px; text-align:right;\">${assetsList}</span></div>\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">ä»£è¡¨ä½œå“</div>\n            ${renderList(works)}\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">è£èª‰è®°å½•</div>\n            ${renderList(awards)}\n        </div>`;\n  },\n  business: (sd: z.infer<typeof Schema>) => {\n    const companyCash = getVal(sd, 'å…¬å¸è´¦æˆ·._ç°é‡‘', 0);\n    const fixedCosts = getVal(sd, 'å…¬å¸è´¦æˆ·.å›ºå®šæˆæœ¬', {});\n    const oneTimeChange = getVal(sd, 'å…¬å¸è´¦æˆ·.å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨', 0);\n    const runningProjects = getVal(sd, 'å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®', {});\n\n    // æ¸²æŸ“å›ºå®šæˆæœ¬ä¸‹çš„æ‰€æœ‰å˜é‡\n    const fixedCostsList: string =\n      typeof fixedCosts === 'object' && fixedCosts !== null\n        ? Object.keys(fixedCosts)\n            .map(key => {\n              const value = fixedCosts[key];\n              const numValue = typeof value === 'number' ? value : parseFloat(String(value)) || 0;\n              return `<div class=\"info-row\">\n                <span class=\"info-key\">${key}</span>\n                <span class=\"info-val\">Â¥${numValue.toLocaleString()}/æœˆ</span>\n              </div>`;\n            })\n            .join('') || '<div style=\"font-size:10px; color:#555; padding:4px;\">æš‚æ— å›ºå®šæˆæœ¬</div>'\n        : '<div style=\"font-size:10px; color:#555; padding:4px;\">æš‚æ— å›ºå®šæˆæœ¬</div>';\n\n    // æ¸²æŸ“è¿è¡Œé¡¹ç›®åˆ—è¡¨\n    const projectsList: string =\n      typeof runningProjects === 'object' && runningProjects !== null\n        ? Object.keys(runningProjects)\n            .map(key => {\n              const project = runningProjects[key];\n              if (typeof project === 'object' && project !== null) {\n                const monthlySales = 'æœˆé”€é‡' in project ? project.æœˆé”€é‡ : 0;\n                const price = 'å•ä»·' in project ? project.å•ä»· : 0;\n                const monthlyProfit = '_æœˆæ¯›åˆ©' in project ? project._æœˆæ¯›åˆ© : 0;\n                const costRate = 'è¾¹é™…æˆæœ¬ç‡' in project ? project.è¾¹é™…æˆæœ¬ç‡ : 0.5;\n                return `<div class=\"list-item project-item\" data-project-name=\"${key.replace(/\"/g, '&quot;')}\" style=\"padding:4px 0;\">\n                      <div style=\"flex:1;\">\n                        <span class=\"hl-val\">${key}</span>\n                        <div style=\"font-size:9px; color:#666; margin-top:2px;\">\n                          é”€é‡: ${monthlySales.toLocaleString()} | å•ä»·: Â¥${price.toLocaleString()} | æˆæœ¬ç‡: ${(costRate * 100).toFixed(0)}%\n                        </div>\n                      </div>\n                      <div style=\"display:flex; align-items:center; gap:8px;\">\n                        <span class=\"dim-val\" style=\"color:${monthlyProfit >= 0 ? '#4a9' : '#a44'};\">\n                          ${monthlyProfit >= 0 ? '+' : ''}Â¥${monthlyProfit.toLocaleString()}\n                        </span>\n                        <div class=\"project-actions\">\n                          <span class=\"btn-small btn-edit-project\" data-project-name=\"${key.replace(/\"/g, '&quot;')}\" title=\"ç¼–è¾‘\">âœï¸</span>\n                          <span class=\"btn-small btn-delete-project\" data-project-name=\"${key.replace(/\"/g, '&quot;')}\" title=\"åˆ é™¤\">ğŸ—‘ï¸</span>\n                        </div>\n                      </div>\n                    </div>`;\n              }\n              return null;\n            })\n            .filter(Boolean)\n            .join('') || '<div style=\"font-size:10px; color:#555; padding:4px;\">æš‚æ— è¿è¡Œé¡¹ç›®</div>'\n        : '<div style=\"font-size:10px; color:#555; padding:4px;\">æš‚æ— è¿è¡Œé¡¹ç›®</div>';\n\n    return `\n        <div class=\"card\">\n            <div class=\"card-title\" style=\"display:flex; justify-content:space-between; align-items:center;\">\n                <span>èµ„äº§</span>\n                <span class=\"btn-small btn-recalculate-cash\" title=\"é‡ç®—ç°é‡‘\" style=\"cursor:pointer; padding:2px 6px; font-size:9px; background:rgba(74,169,74,0.3); border-radius:4px;\">ğŸ”„ é‡ç®—ç°é‡‘</span>\n            </div>\n            <div class=\"info-row\"><span class=\"info-key\">ç°é‡‘</span><span class=\"info-val\" style=\"color:#4a9; font-weight:700;\">Â¥${companyCash.toLocaleString()}</span></div>\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">è¿è¡Œé¡¹ç›®</div>\n            ${projectsList}\n            <div class=\"btn-add btn-add-project\">+ æ–°å¢é¡¹ç›®</div>\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">å›ºå®šæˆæœ¬</div>\n            ${fixedCostsList}\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨</div>\n            <div class=\"info-row\">\n                <span class=\"info-key\">ä¸€æ¬¡æ€§å˜åŠ¨</span>\n                <span class=\"info-val\" style=\"color:${oneTimeChange >= 0 ? '#4a9' : '#a44'}; font-weight:${oneTimeChange !== 0 ? '700' : '500'};\">\n                    ${oneTimeChange >= 0 ? '+' : ''}Â¥${oneTimeChange.toLocaleString()}\n                </span>\n            </div>\n        </div>`;\n  },\n  social: (sd: z.infer<typeof Schema>) => {\n    const circles = getVal(sd, 'äººè„‰.ç¤¾äº¤ç‰ˆå›¾', []);\n    const interactions = getVal(sd, 'äººè„‰.è¿‘æœŸäº’åŠ¨', []);\n    const relationMap = getVal(sd, 'äººè„‰.å…³ç³»ç°¿', {});\n    const relationList: Array<{ name: string; v: number }> = [];\n    if (typeof relationMap === 'object' && relationMap !== null) {\n      for (const k in relationMap) {\n        const v = typeof relationMap[k] === 'number' ? relationMap[k] : parseInt(String(relationMap[k])) || 0;\n        relationList.push({ name: k, v });\n      }\n    }\n    const allies = relationList.filter(r => r.v > 30).sort((a, b) => b.v - a.v);\n    const enemies = relationList.filter(r => r.v < -30).sort((a, b) => a.v - b.v);\n    const renderTags = (arr: string[]) =>\n      Array.isArray(arr) && arr.length > 0 && arr[0] !== 'æ— '\n        ? arr\n            .map(\n              i =>\n                `<span style=\"display:inline-block; background:rgba(255,255,255,0.1); padding:2px 5px; border-radius:3px; font-size:10px; margin-right:4px; margin-bottom:4px;\">${i}</span>`,\n            )\n            .join('')\n        : '<span style=\"color:#555; font-size:10px;\">æ— </span>';\n    const renderRel = (list: Array<{ name: string; v: number }>) =>\n      list.length\n        ? list\n            .map(\n              r =>\n                `<div class=\"list-item\"><span class=\"hl-val\">${r.name}</span><span class=\"dim-val\">${r.v}</span></div>`,\n            )\n            .join('')\n        : '<div style=\"font-size:10px; color:#555;\">æ— </div>';\n    const renderInter = (arr: string[]) =>\n      Array.isArray(arr) && arr.length > 0 && arr[0] !== 'æ— '\n        ? arr.map(i => `<div style=\"font-size:10px; color:#ccc; margin-bottom:3px;\">â€¢ ${i}</div>`).join('')\n        : '<div style=\"font-size:10px; color:#555;\">æ— </div>';\n    return `\n        <div class=\"card\">\n            <div class=\"card-title\">ç¤¾äº¤ç‰ˆå›¾</div>\n            <div>${renderTags(circles)}</div>\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">è¿‘æœŸäº’åŠ¨</div>\n            <div>${renderInter(interactions)}</div>\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">æ ¸å¿ƒç›Ÿå‹</div>\n            ${renderRel(allies)}\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">æ½œåœ¨æ•Œå¯¹</div>\n            ${renderRel(enemies)}\n        </div>`;\n  },\n  world: (sd: z.infer<typeof Schema>) => {\n    const date = getVal(sd, 'ä¸–ç•Œ.å½“å‰æ—¥æœŸ', 'å¾…å®š');\n    const loc = getVal(sd, 'ä¸–ç•Œ.å½“å‰åœ°ç‚¹', 'å¾…å®š');\n    const n1 = getVal(sd, 'ä¸–ç•Œ.æ—¶ä»£æ–°é—»', 'æ— ');\n    const n2 = getVal(sd, 'ä¸–ç•Œ.è¡Œä¸šæ–°é—»', 'æ— ');\n    const n3 = getVal(sd, 'ä¸–ç•Œ.å…«å¦æ–°é—»', 'æ— ');\n    const level = getVal(sd, 'ä¸“ä¸šè¯„ä¼°.å½“å‰å’–ä½', 'æ— ');\n    const ability = getVal(sd, 'ä¸“ä¸šè¯„ä¼°.ä¸šåŠ¡èƒ½åŠ›', 'æ— ');\n    const media = getVal(sd, 'ä¸“ä¸šè¯„ä¼°.åª’ä½“é£å‘', 'æ— ');\n    const publicRep = getVal(sd, 'ä¸“ä¸šè¯„ä¼°.ç¤¾ä¼šé£è¯„', 'æ— ');\n    const fans = getVal(sd, 'ä¸“ä¸šè¯„ä¼°.ç²‰ä¸åŸºç¡€', 'æ— ');\n    return `\n        <div class=\"card\" style=\"text-align:center;\">\n            <div style=\"font-size:14px; font-weight:700; color:#fff; margin-bottom:4px;\">${date}</div>\n            <div style=\"font-size:10px; color:#888;\">ğŸ“ ${loc}</div>\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">æ–°é—»åŠ¨æ€</div>\n            <div class=\"info-block\"><b style=\"color:#888;\">æ—¶ä»£:</b> ${n1}</div>\n            <div class=\"info-block\"><b style=\"color:#888;\">è¡Œä¸š:</b> ${n2}</div>\n            <div class=\"info-block\"><b style=\"color:#888;\">å…«å¦:</b> ${n3}</div>\n        </div>\n        <div class=\"card\">\n            <div class=\"card-title\">ä¸“ä¸šè¯„ä¼°</div>\n            <div class=\"info-row\"><span class=\"info-key\">å½“å‰å’–ä½</span><span class=\"info-val\">${level}</span></div>\n            <div class=\"info-row\"><span class=\"info-key\">ä¸šåŠ¡èƒ½åŠ›</span><span class=\"info-val\">${ability}</span></div>\n            <div class=\"info-row\"><span class=\"info-key\">åª’ä½“é£å‘</span><span class=\"info-val\">${media}</span></div>\n            <div class=\"info-row\"><span class=\"info-key\">ç¤¾ä¼šé£è¯„</span><span class=\"info-val\">${publicRep}</span></div>\n            <div class=\"info-row\"><span class=\"info-key\">ç²‰ä¸åŸºç¡€</span><span class=\"info-val\">${fans}</span></div>\n        </div>`;\n  },\n};\n\nfunction initFatePhone() {\n  $('head').append(fateStyles);\n  $('body').prepend(fateTemplate);\n\n  // æ·»åŠ é¡¹ç›®ç¼–è¾‘æ¨¡æ€æ¡†\n  const modalHtml = `\n    <div id=\"project-modal\" class=\"modal-overlay\">\n      <div class=\"modal-content\">\n        <div class=\"modal-title\" id=\"modal-title\">æ–°å¢è¿è¡Œé¡¹ç›®</div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">é¡¹ç›®åç§°</label>\n          <input type=\"text\" id=\"modal-project-name\" class=\"form-input\" placeholder=\"è¯·è¾“å…¥é¡¹ç›®åç§°\" />\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">æœˆé”€é‡</label>\n          <input type=\"number\" id=\"modal-monthly-sales\" class=\"form-input\" placeholder=\"0\" min=\"0\" step=\"1\" />\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">å•ä»· (Â¥)</label>\n          <input type=\"number\" id=\"modal-price\" class=\"form-input\" placeholder=\"0\" min=\"0\" step=\"0.01\" />\n        </div>\n        <div class=\"form-group\">\n          <label class=\"form-label\">è¾¹é™…æˆæœ¬ç‡ (0-1)</label>\n          <input type=\"number\" id=\"modal-cost-rate\" class=\"form-input\" placeholder=\"0.5\" min=\"0\" max=\"1\" step=\"0.01\" />\n        </div>\n        <div class=\"modal-actions\">\n          <button class=\"btn-modal btn-modal-secondary\" id=\"modal-cancel\">å–æ¶ˆ</button>\n          <button class=\"btn-modal btn-modal-primary\" id=\"modal-save\">ä¿å­˜</button>\n        </div>\n      </div>\n    </div>\n  `;\n  $('body').append(modalHtml);\n\n  const container = $('#fate-phone-container');\n  const content = $('#fp-content');\n\n  const applyPosition = () => {\n    const pos = POSITIONS[fateState.posIndex];\n    container.css({ top: 'auto', bottom: 'auto', left: 'auto', right: 'auto' });\n    container.css(pos.css);\n  };\n  applyPosition();\n\n  const render = () => {\n    const sd = getMvuDataSafe();\n    $('#fp-title').text('é€æ¢¦æ¼”è‰ºåœˆ');\n    $('#fp-quote').text('åœ¨å¨±ä¹åœˆçš„æµ®æ²‰ä¸­å¯»æ‰¾è‡ªå·±çš„ä½ç½®');\n    const timeStr = getVal(sd, 'ä¸–ç•Œ.å½“å‰æ—¥æœŸ', 'å¾…å®š');\n    const timeMatch = timeStr.match(/(\\d{2}:\\d{2})/);\n    $('#fp-clock').text(timeMatch ? timeMatch[1] : '12:00');\n    const bgmBtn = $('#btn-bgm');\n    bgmBtn.text(fateState.isBgmOn ? 'ğŸ”Š' : 'ğŸ”‡');\n    bgmBtn.css('opacity', fateState.isBgmOn ? '1' : '0.5');\n    if (fateState.isCollapsed) container.addClass('collapsed');\n    else container.removeClass('collapsed');\n    const renderer = renderModules[fateState.currentTab as keyof typeof renderModules] || renderModules.home;\n    $('#fp-content').html(renderer(sd));\n    $('.nav-item').removeClass('active');\n    $(`.nav-item[data-tab=\"${fateState.currentTab}\"]`).addClass('active');\n  };\n\n  const audio = window.fateAudioInstance;\n  $(document).one('click', function () {\n    if (fateState.isBgmOn && audio.paused) audio.play();\n  });\n\n  container.on('click', '.nav-item', function (e) {\n    e.stopPropagation();\n    fateState.currentTab = $(this).data('tab');\n    localStorage.setItem(window.FATE_CONFIG.storageTab, fateState.currentTab);\n    render();\n  });\n\n  const toggleCollapse = (e: JQuery.Event) => {\n    e.stopPropagation();\n    fateState.isCollapsed = !fateState.isCollapsed;\n    localStorage.setItem(window.FATE_CONFIG.storageCollapse, String(fateState.isCollapsed));\n    render();\n  };\n  container.on('click', '#btn-collapse, .icon-placeholder', toggleCollapse);\n\n  container.on('click', '#btn-bgm', function (e) {\n    e.stopPropagation();\n    fateState.isBgmOn = !fateState.isBgmOn;\n    render();\n    if (fateState.isBgmOn) audio.play().catch(() => {});\n    else audio.pause();\n  });\n\n  // æ—¶é—´æŒ‰é’®ç‚¹å‡»å¤„ç†ï¼ˆæ”¯æŒè§¦æ‘¸å’Œé¼ æ ‡ï¼‰\n  let clockClickTimer: NodeJS.Timeout | null = null;\n  const handleClockClick = (e: JQuery.Event) => {\n    e.stopPropagation();\n    e.preventDefault();\n\n    // é˜²æŠ–å¤„ç†ï¼Œé¿å…å¿«é€Ÿå¤šæ¬¡ç‚¹å‡»\n    if (clockClickTimer) {\n      clearTimeout(clockClickTimer);\n    }\n    clockClickTimer = setTimeout(() => {\n      fateState.posIndex = (fateState.posIndex + 1) % POSITIONS.length;\n      localStorage.setItem(window.FATE_CONFIG.storagePosIndex, String(fateState.posIndex));\n      applyPosition();\n      clockClickTimer = null;\n    }, 150);\n  };\n\n  container.on('click', '#fp-clock', handleClockClick);\n  // é˜»æ­¢è§¦æ‘¸äº‹ä»¶è§¦å‘æ‹–æ‹½é€»è¾‘\n  container.on('touchstart', '#fp-clock', function (e) {\n    e.stopPropagation();\n  });\n  container.on('touchend', '#fp-clock', function (e) {\n    e.stopPropagation();\n    // è§¦æ‘¸ç»“æŸæ—¶ä¹Ÿè§¦å‘ä½ç½®åˆ‡æ¢\n    handleClockClick(e);\n  });\n\n  // é¡¹ç›®ç¼–è¾‘ç›¸å…³å‡½æ•°\n  const openProjectModal = (projectName?: string) => {\n    const modal = $('#project-modal');\n    const isEdit = !!projectName;\n\n    $('#modal-title').text(isEdit ? 'ç¼–è¾‘è¿è¡Œé¡¹ç›®' : 'æ–°å¢è¿è¡Œé¡¹ç›®');\n    $('#modal-project-name').val(projectName || '');\n    $('#modal-project-name').prop('disabled', isEdit);\n\n    if (isEdit) {\n      try {\n        const variables = window.Mvu!.getMvuData({ type: 'message', message_id: 'latest' });\n        const stat_data = Schema.parse(_.get(variables, 'stat_data', {}));\n        const projects = stat_data.å…¬å¸è´¦æˆ·?.è¿è¡Œé¡¹ç›®;\n        if (projects && typeof projects === 'object' && projectName) {\n          const project = projects[projectName];\n          if (project && typeof project === 'object') {\n            $('#modal-monthly-sales').val(project.æœˆé”€é‡ || 0);\n            $('#modal-price').val(project.å•ä»· || 0);\n            $('#modal-cost-rate').val(project.è¾¹é™…æˆæœ¬ç‡ || 0.5);\n          }\n        }\n      } catch (e) {\n        console.warn('è·å–é¡¹ç›®æ•°æ®å¤±è´¥:', e);\n      }\n    } else {\n      $('#modal-monthly-sales').val('');\n      $('#modal-price').val('');\n      $('#modal-cost-rate').val('0.5');\n    }\n\n    modal.addClass('show');\n  };\n\n  const closeProjectModal = () => {\n    $('#project-modal').removeClass('show');\n  };\n\n  const saveProject = async () => {\n    const projectName = String($('#modal-project-name').val() || '').trim();\n    if (!projectName) {\n      toastr.warning('è¯·è¾“å…¥é¡¹ç›®åç§°');\n      return;\n    }\n\n    const monthlySales = parseFloat(String($('#modal-monthly-sales').val() || '0'));\n    const price = parseFloat(String($('#modal-price').val() || '0'));\n    const costRate = parseFloat(String($('#modal-cost-rate').val() || '0.5'));\n\n    if (isNaN(monthlySales) || isNaN(price) || isNaN(costRate)) {\n      toastr.warning('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼');\n      return;\n    }\n\n    if (costRate < 0 || costRate > 1) {\n      toastr.warning('è¾¹é™…æˆæœ¬ç‡å¿…é¡»åœ¨0-1ä¹‹é—´');\n      return;\n    }\n\n    try {\n      const variables = window.Mvu!.getMvuData({ type: 'message', message_id: 'latest' });\n      const stat_data = Schema.parse(_.get(variables, 'stat_data', {}));\n\n      if (!stat_data.å…¬å¸è´¦æˆ·) {\n        stat_data.å…¬å¸è´¦æˆ· = {\n          è¿è¡Œé¡¹ç›®: {},\n          å›ºå®šæˆæœ¬: { äººåŠ›æˆæœ¬: 0, æˆ¿ç§Ÿ: 0 },\n          å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨: 0,\n          _ç°é‡‘: 0,\n        };\n      }\n      if (!stat_data.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®) {\n        stat_data.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›® = {};\n      }\n\n      // è®¡ç®—æœˆæ¯›åˆ©\n      const monthlyProfit = monthlySales * price * (1 - costRate);\n\n      stat_data.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®[projectName] = {\n        æœˆé”€é‡: monthlySales,\n        å•ä»·: price,\n        è¾¹é™…æˆæœ¬ç‡: _.clamp(costRate, 0, 1),\n        _æœˆæ¯›åˆ©: monthlyProfit,\n      };\n\n      _.set(variables, 'stat_data', stat_data);\n      await window.Mvu!.replaceMvuData(variables, { type: 'message', message_id: 'latest' });\n\n      closeProjectModal();\n      render();\n      toastr.success('ä¿å­˜æˆåŠŸ');\n    } catch (e) {\n      console.error('ä¿å­˜é¡¹ç›®å¤±è´¥:', e);\n      toastr.error('ä¿å­˜å¤±è´¥: ' + (e instanceof Error ? e.message : String(e)));\n    }\n  };\n\n  const deleteProject = async (projectName: string) => {\n    if (!confirm(`ç¡®å®šè¦åˆ é™¤é¡¹ç›®\"${projectName}\"å—ï¼Ÿ`)) {\n      return;\n    }\n\n    try {\n      const variables = window.Mvu!.getMvuData({ type: 'message', message_id: 'latest' });\n      const stat_data = Schema.parse(_.get(variables, 'stat_data', {}));\n\n      if (stat_data.å…¬å¸è´¦æˆ·?.è¿è¡Œé¡¹ç›® && projectName in stat_data.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®) {\n        delete stat_data.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®[projectName];\n        _.set(variables, 'stat_data', stat_data);\n        await window.Mvu!.replaceMvuData(variables, { type: 'message', message_id: 'latest' });\n\n        render();\n        toastr.success('åˆ é™¤æˆåŠŸ');\n      }\n    } catch (e) {\n      console.error('åˆ é™¤é¡¹ç›®å¤±è´¥:', e);\n      toastr.error('åˆ é™¤å¤±è´¥: ' + (e instanceof Error ? e.message : String(e)));\n    }\n  };\n\n  // é‡ç®—ç°é‡‘åŠŸèƒ½\n  const recalculateCash = async () => {\n    try {\n      // è·å–å½“å‰æ¥¼å±‚çš„å˜é‡ï¼ˆæœ€æ–°ï¼‰\n      const currentVariables = window.Mvu!.getMvuData({ type: 'message', message_id: 'latest' });\n      const currentStatData = Schema.parse(_.get(currentVariables, 'stat_data', {}));\n\n      // è·å–ä¸Šä¸€æ¥¼å±‚çš„å˜é‡ï¼ˆå€’æ•°ç¬¬äºŒæ¥¼ï¼‰\n      let oldVariables;\n      try {\n        oldVariables = window.Mvu!.getMvuData({ type: 'message', message_id: -2 });\n      } catch (e) {\n        // å¦‚æœæ²¡æœ‰ä¸Šä¸€æ¥¼å±‚ï¼Œä½¿ç”¨å½“å‰æ¥¼å±‚çš„æ•°æ®ä½œä¸ºæ—§æ•°æ®\n        oldVariables = currentVariables;\n      }\n      const oldStatData = _.get(oldVariables, 'stat_data', {});\n\n      const oldCurrentDate = _.get(oldStatData, 'ä¸–ç•Œ.å½“å‰æ—¥æœŸ');\n      const newCurrentDate = _.get(currentStatData, 'ä¸–ç•Œ.å½“å‰æ—¥æœŸ');\n      const oldCompanyCash = _.get(oldStatData, 'å…¬å¸è´¦æˆ·._ç°é‡‘', 0);\n      const oneTimeChange = _.get(currentStatData, 'å…¬å¸è´¦æˆ·.å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨', 0);\n      const oldFixedCosts = _.get(oldStatData, 'å…¬å¸è´¦æˆ·.å›ºå®šæˆæœ¬', {});\n      const oldRunningProjects = _.get(oldStatData, 'å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®', {});\n\n      if (oldCurrentDate && newCurrentDate && oldCurrentDate !== 'å¾…å®š' && newCurrentDate !== 'å¾…å®š') {\n        // è®¡ç®—è·¨æœˆæ•°\n        const monthCrossing = calculateMonthCrossing(oldCurrentDate, newCurrentDate);\n\n        // è®¡ç®—æ–°çš„ç°é‡‘å€¼\n        const calculatedCash = calculateCompanyCash(\n          oldCompanyCash,\n          oneTimeChange,\n          monthCrossing,\n          oldFixedCosts,\n          oldRunningProjects,\n        );\n\n        // æ›´æ–°å˜é‡\n        _.set(currentStatData, 'å…¬å¸è´¦æˆ·._ç°é‡‘', calculatedCash);\n        _.set(currentVariables, 'stat_data', currentStatData);\n        await window.Mvu!.replaceMvuData(currentVariables, { type: 'message', message_id: 'latest' });\n\n        // æ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯\n        const humanCost = Number(_.get(oldFixedCosts, 'äººåŠ›æˆæœ¬')) || 0;\n        const rentCost = Number(_.get(oldFixedCosts, 'æˆ¿ç§Ÿ')) || 0;\n        const totalFixedCost = humanCost + rentCost;\n\n        let totalMonthlyProfit = 0;\n        if (oldRunningProjects && typeof oldRunningProjects === 'object') {\n          for (const project_name in oldRunningProjects) {\n            const project = oldRunningProjects[project_name];\n            if (project && typeof project === 'object' && '_æœˆæ¯›åˆ©' in project) {\n              totalMonthlyProfit += Number(project._æœˆæ¯›åˆ©) || 0;\n            }\n          }\n        }\n\n        let message = `ç°é‡‘é‡ç®—å®Œæˆï¼\\næ—§ç°é‡‘: Â¥${oldCompanyCash.toLocaleString()}\\næ–°ç°é‡‘: Â¥${calculatedCash.toLocaleString()}`;\n        if (monthCrossing > 0) {\n          message += `\\nè·¨æœˆæ•°: ${monthCrossing}\\nå›ºå®šæˆæœ¬: Â¥${totalFixedCost.toLocaleString()}/æœˆ\\næœˆæ¯›åˆ©æ€»å’Œ: Â¥${totalMonthlyProfit.toLocaleString()}/æœˆ`;\n        }\n        toastr.success(message, 'é‡ç®—ç°é‡‘', { timeOut: 5000 });\n\n        render();\n      } else {\n        // å¦‚æœæ—¥æœŸä¿¡æ¯ä¸å®Œæ•´ï¼Œä½¿ç”¨ç®€åŒ–è®¡ç®—ï¼šå½“å‰ç°é‡‘ + ä¸€æ¬¡æ€§å˜åŠ¨\n        const currentCash = _.get(currentStatData, 'å…¬å¸è´¦æˆ·._ç°é‡‘', 0);\n        const newCash = currentCash + oneTimeChange;\n        _.set(currentStatData, 'å…¬å¸è´¦æˆ·._ç°é‡‘', newCash);\n        _.set(currentVariables, 'stat_data', currentStatData);\n        await window.Mvu!.replaceMvuData(currentVariables, { type: 'message', message_id: 'latest' });\n\n        toastr.success(\n          `ç°é‡‘é‡ç®—å®Œæˆï¼\\nå½“å‰ç°é‡‘: Â¥${currentCash.toLocaleString()}\\nä¸€æ¬¡æ€§å˜åŠ¨: ${oneTimeChange >= 0 ? '+' : ''}Â¥${oneTimeChange.toLocaleString()}\\næ–°ç°é‡‘: Â¥${newCash.toLocaleString()}`,\n          'é‡ç®—ç°é‡‘',\n          { timeOut: 5000 },\n        );\n        render();\n      }\n    } catch (e) {\n      console.error('é‡ç®—ç°é‡‘å¤±è´¥:', e);\n      toastr.error('é‡ç®—ç°é‡‘å¤±è´¥: ' + (e instanceof Error ? e.message : String(e)));\n    }\n  };\n\n  // ç»‘å®šé¡¹ç›®ç¼–è¾‘äº‹ä»¶\n  container.on('click', '.btn-add-project', function (e) {\n    e.stopPropagation();\n    openProjectModal();\n  });\n\n  container.on('click', '.btn-edit-project', function (e) {\n    e.stopPropagation();\n    const projectName = $(this).data('project-name');\n    if (projectName) {\n      openProjectModal(projectName);\n    }\n  });\n\n  container.on('click', '.btn-delete-project', function (e) {\n    e.stopPropagation();\n    const projectName = $(this).data('project-name');\n    if (projectName) {\n      deleteProject(projectName);\n    }\n  });\n\n  // ç»‘å®šé‡ç®—ç°é‡‘äº‹ä»¶\n  container.on('click', '.btn-recalculate-cash', function (e) {\n    e.stopPropagation();\n    recalculateCash();\n  });\n\n  // æ¨¡æ€æ¡†äº‹ä»¶\n  $('#modal-cancel, #project-modal').on('click', function (e) {\n    if (e.target === this) {\n      closeProjectModal();\n    }\n  });\n\n  $('#modal-save').on('click', function (e) {\n    e.stopPropagation();\n    saveProject();\n  });\n\n  // æ¨¡æ€æ¡†å†…è¾“å…¥æ¡†å›è½¦ä¿å­˜\n  $('#project-modal input').on('keydown', function (e) {\n    if (e.key === 'Enter') {\n      e.preventDefault();\n      saveProject();\n    }\n  });\n\n  let isDown = false;\n  let startY: number;\n  let scrollTop: number;\n\n  const startDrag = (y: number) => {\n    isDown = true;\n    content.addClass('grabbing');\n    startY = y - content.offset()!.top;\n    scrollTop = content.scrollTop()!;\n  };\n\n  const doDrag = (y: number) => {\n    if (!isDown) return;\n    const yPos = y - content.offset()!.top;\n    const walk = (yPos - startY) * 1.5;\n    content.scrollTop(scrollTop - walk);\n  };\n\n  const stopDrag = () => {\n    isDown = false;\n    content.removeClass('grabbing');\n  };\n\n  content.on('mousedown', e => startDrag(e.pageY));\n  content.on('mouseleave', stopDrag);\n  content.on('mouseup', stopDrag);\n  content.on('mousemove', e => {\n    if (isDown) {\n      e.preventDefault();\n      doDrag(e.pageY);\n    }\n  });\n\n  content.on('touchstart', e => startDrag(e.originalEvent.touches[0].pageY));\n  content.on('touchend', stopDrag);\n  content.on('touchmove', e => {\n    if (isDown) {\n      doDrag(e.originalEvent.touches[0].pageY);\n    }\n  });\n\n  render();\n  let initCount = 0;\n  const initInterval = setInterval(() => {\n    render();\n    initCount++;\n    if (initCount > 6) clearInterval(initInterval);\n  }, 500);\n\n  let updateTimer: NodeJS.Timeout | null = null;\n  const debouncedUpdate = () => {\n    if (updateTimer) clearTimeout(updateTimer);\n    updateTimer = setTimeout(() => {\n      render();\n      updateTimer = null;\n    }, 500);\n  };\n\n  if (window.eventOn) {\n    if (window.tavern_events) eventOn(tavern_events.MESSAGE_RECEIVED, debouncedUpdate);\n    if (window.Mvu && Mvu.events) eventOn(Mvu.events.VARIABLE_UPDATE_ENDED, debouncedUpdate);\n    try {\n      if (window.parent && window.parent.eventOn && window.parent.Mvu) {\n        window.parent.eventOn(window.parent.Mvu.events.VARIABLE_UPDATE_ENDED, debouncedUpdate);\n      }\n    } catch (e) {}\n  }\n}\n\n$(\n  errorCatched(async () => {\n    await waitGlobalInitialized('Mvu');\n    await waitUntil(() => {\n      try {\n        if (window.Mvu && typeof window.Mvu.getMvuData === 'function') {\n          const variables = window.Mvu.getMvuData({ type: 'message', message_id: 'latest' });\n          return variables && _.has(variables, 'stat_data');\n        }\n      } catch (e) {\n        return false;\n      }\n      return false;\n    });\n    const checkReady = setInterval(() => {\n      if (window.jQuery) {\n        clearInterval(checkReady);\n        initFatePhone();\n      }\n    }, 200);\n  }),\n);\n\n$(window).on('pagehide', () => {\n  $('#fate-phone-container, #fate-phone-css, #project-modal').remove();\n  $(document).off('.fatephone');\n});\n"],"names":["z","Schema","object","string","prefault","coerce","number","array","record","describe","transform","v","_","clamp","parseDate","dateStr","match","year","parseInt","month","day","Date","$","remove","window","fateAudioInstance","Audio","loop","volume","document","off","FATE_CONFIG","storagePosIndex","storageCollapse","storageTab","POSITIONS","name","css","top","left","bottom","right","fateState","currentTab","localStorage","getItem","isBgmOn","isCollapsed","posIndex","getVal","data","path","def","current","keys","split","key","e","renderModules","home","sd","age","ageStr","job","partner","lover","child","cash","contract","assets","assetsList","Object","map","item","count","filter","Boolean","join","works","awards","renderList","arr","Array","isArray","length","toLocaleString","business","companyCash","fixedCosts","oneTimeChange","runningProjects","fixedCostsList","value","parseFloat","String","projectsList","project","monthlySales","price","monthlyProfit","costRate","replace","toFixed","social","circles","interactions","relationMap","relationList","k","push","allies","r","sort","a","b","enemies","renderRel","list","i","renderInter","world","initFatePhone","append","prepend","container","content","applyPosition","pos","render","Mvu","getMvuData","variables","type","message_id","stat_data","parse","console","warn","getMvuDataSafe","text","timeMatch","bgmBtn","addClass","removeClass","renderer","html","audio","one","paused","play","on","stopPropagation","this","setItem","catch","pause","clockClickTimer","handleClockClick","preventDefault","clearTimeout","setTimeout","openProjectModal","projectName","modal","isEdit","val","prop","get","projects","closeProjectModal","saveProject","async","trim","toastr","warning","isNaN","set","replaceMvuData","success","error","Error","message","recalculateCash","currentVariables","currentStatData","oldVariables","oldStatData","oldCurrentDate","newCurrentDate","oldCompanyCash","oldFixedCosts","oldRunningProjects","monthCrossing","oldDateStr","newDateStr","oldDate","newDate","oldYear","getFullYear","oldMonth","getMonth","oldDay","getDate","newYear","newMonth","currentYear","currentMonth","monthCount","calculateMonthCrossing","calculatedCash","oldCash","Number","totalFixedCost","totalMonthlyProfit","project_name","calculateCompanyCash","humanCost","timeOut","currentCash","newCash","confirm","deleteProject","target","startY","scrollTop","isDown","startDrag","y","offset","doDrag","walk","stopDrag","pageY","originalEvent","touches","initCount","initInterval","setInterval","clearInterval","updateTimer","debouncedUpdate","eventOn","tavern_events","MESSAGE_RECEIVED","events","VARIABLE_UPDATE_ENDED","parent","errorCatched","waitGlobalInitialized","has","checkReady","jQuery"],"ignoreList":[],"sourceRoot":""}