import{waitUntil as t}from'https://testingcf.jsdelivr.net/npm/async-wait-until/+esm';const n=z,e=n.z.object({ä¸–ç•Œ:n.z.object({å½“å‰æ—¥æœŸ:n.z.string().prefault('å¾…å®š'),å½“å‰åœ°ç‚¹:n.z.string().prefault('å¾…å®š'),æ—¶ä»£æ–°é—»:n.z.string().prefault('å¾…å®š'),è¡Œä¸šæ–°é—»:n.z.string().prefault('å¾…å®š'),å…«å¦æ–°é—»:n.z.string().prefault('å¾…å®š')}),ä¸»è§’:n.z.object({å§“å:n.z.string().prefault('å¾…å®š'),æ€§åˆ«:n.z.string().prefault('å¾…å®š'),å›½ç±:n.z.string().prefault('å¾…å®š'),ç”Ÿæ—¥:n.z.string().prefault('å¾…å®š'),_å¹´é¾„:n.z.coerce.number().prefault(0),å¤–è²Œ:n.z.string().prefault('å¾…å®š'),èŒä¸š:n.z.string().prefault('å¾…å®š'),æ€§ç™–:n.z.string().prefault('æ— '),é…å¶:n.z.string().prefault('æ— '),å­å¥³:n.z.string().prefault('æ— '),æƒ…äºº:n.z.string().prefault('æ— ')}),èŒä¸šå±¥å†:n.z.object({ä½œå“å:n.z.array(n.z.string()).prefault([]),è·å–å¥–é¡¹:n.z.array(n.z.string()).prefault([])}),ä¸“ä¸šè¯„ä¼°:n.z.object({å½“å‰å’–ä½:n.z.string().prefault('æ— '),ä¸šåŠ¡èƒ½åŠ›:n.z.string().prefault('æ— '),åª’ä½“é£å‘:n.z.string().prefault('æ— '),ç¤¾ä¼šé£è¯„:n.z.string().prefault('æ— '),ç²‰ä¸åŸºç¡€:n.z.string().prefault('æ— ')}),ä¸ªäººè´¦æˆ·:n.z.object({ç°é‡‘:n.z.coerce.number().prefault(0),åˆçº¦çŠ¶æ€:n.z.string().prefault('æ— '),æŒæœ‰èµ„äº§:n.z.record(n.z.string(),n.z.object({æ•°é‡:n.z.coerce.number().prefault(0)})).prefault({}).describe('Key:èµ„äº§åç§°')}).prefault({}),å…¬å¸è´¦æˆ·:n.z.object({è¿è¡Œé¡¹ç›®:n.z.record(n.z.string().describe('ä¸šåŠ¡çº¿åç§°'),n.z.object({æœˆé”€é‡:n.z.coerce.number().prefault(0).describe('æœˆé”€é‡/æœˆæ´»'),å•ä»·:n.z.coerce.number().prefault(0).describe('å•ä»·/ARPU'),è¾¹é™…æˆæœ¬ç‡:n.z.coerce.number().transform(t=>_.clamp(t,0,1)).prefault(.5),_æœˆæ¯›åˆ©:n.z.coerce.number().prefault(0).describe('ç”±è„šæœ¬è®¡ç®—ï¼šæœˆé”€é‡ * å•ä»· * (1 - è¾¹é™…æˆæœ¬ç‡)')})).prefault({}).describe('å…¬å¸æ­£åœ¨è¿è¥çš„ä¸šåŠ¡çº¿/äº§å“çº¿ï¼Œç”¨äºè®¡ç®—ç»è¥æ€§æ”¶å…¥'),å›ºå®šæˆæœ¬:n.z.object({äººåŠ›æˆæœ¬:n.z.coerce.number().prefault(0),æˆ¿ç§Ÿ:n.z.coerce.number().prefault(0)}).prefault({}),å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨:n.z.coerce.number().prefault(0).describe('éç»è¥æ€§èµ„é‡‘æµåŠ¨ï¼Œä¸»è¥ä¸šåŠ¡æ”¶å…¥ä¸è®¡å…¥ï¼ˆæ­£æ•°=æ”¶å…¥ï¼Œè´Ÿæ•°=æ”¯å‡ºï¼‰'),_ç°é‡‘:n.z.coerce.number().prefault(0)}).prefault({}),äººè„‰:n.z.object({ç¤¾äº¤ç‰ˆå›¾:n.z.array(n.z.string()).prefault(['æ— ']),è¿‘æœŸäº’åŠ¨:n.z.array(n.z.string()).describe('æœ€è¿‘æœ‰è¿‡å…³é”®äº¤äº’çš„äºº').prefault(['æ— ']),å…³ç³»ç°¿:n.z.record(n.z.string(),n.z.coerce.number()).prefault({})}),è´è¶æ•ˆåº”:n.z.object({å·²æŠ¹é™¤åˆ—è¡¨:n.z.record(n.z.string(),n.z.string().describe('åŸä½œè€…')).prefault({})})});function a(t){if(!t||'å¾…å®š'===t)return null;const n=t.match(/(\d{4})-(\d{2})-(\d{2})/);if(!n)return null;const e=parseInt(n[1],10),a=parseInt(n[2],10)-1,o=parseInt(n[3],10);return new Date(e,a,o)}$('#fate-phone-container, #fate-phone-css').remove(),window.fateAudioInstance||(window.fateAudioInstance=new Audio('https://musify.club/track/pl/4437680/tomoyasu-hotei-battle-without-honor-or-humanity.mp3'),window.fateAudioInstance.loop=!0,window.fateAudioInstance.volume=.4),$(document).off('.fatephone'),window.FATE_CONFIG={storagePosIndex:'fate_phone_pos_index_v9',storageCollapse:'fate_phone_collapsed',storageTab:'fate_phone_tab'};const o=[{name:'TL',css:{top:'60px',left:'10px',bottom:'auto',right:'auto'}},{name:'TR',css:{top:'60px',right:'10px',bottom:'auto',left:'auto'}},{name:'BR',css:{bottom:'20px',right:'10px',top:'auto',left:'auto'}},{name:'BL',css:{bottom:'20px',left:'10px',top:'auto',right:'auto'}}],s={currentTab:localStorage.getItem(window.FATE_CONFIG.storageTab)||'home',isBgmOn:!1,isCollapsed:'true'===localStorage.getItem(window.FATE_CONFIG.storageCollapse),posIndex:parseInt(localStorage.getItem(window.FATE_CONFIG.storagePosIndex))||0};const i=(t,n,e='æ— ')=>{if(!t)return e;let a=t;try{const t=n.split('.');for(const n of t){if(null==a)return e;a=a[n]}return null!=a&&''!==a?a:e}catch(t){return e}},r={home:t=>{const n=i(t,'ä¸»è§’.å§“å','æœªçŸ¥'),e=i(t,'ä¸»è§’._å¹´é¾„',0),a=e>0?`${e}å²`:'æœªçŸ¥',o=i(t,'ä¸»è§’.èŒä¸š','å¾…å®š'),s=i(t,'ä¸»è§’.é…å¶','æ— '),r=i(t,'ä¸»è§’.æƒ…äºº','æ— '),l=i(t,'ä¸»è§’.å­å¥³','æ— '),c=i(t,'ä¸ªäººè´¦æˆ·.ç°é‡‘',0),d=i(t,'ä¸ªäººè´¦æˆ·.åˆçº¦çŠ¶æ€','æ— '),p=i(t,'ä¸ªäººè´¦æˆ·.æŒæœ‰èµ„äº§',{}),v='object'==typeof p&&null!==p&&Object.keys(p).map(t=>{const n=p[t],e='object'==typeof n&&null!==n&&'æ•°é‡'in n?n.æ•°é‡:0;return e>0?`${t}Ã—${e}`:null}).filter(Boolean).join('ã€')||'æ— ',f=i(t,'èŒä¸šå±¥å†.ä½œå“å',[]),g=i(t,'èŒä¸šå±¥å†.è·å–å¥–é¡¹',[]),u=t=>Array.isArray(t)&&0!==t.length?t.map(t=>`<div class="list-item"><span class="hl-val">${t}</span></div>`).join(''):'<div style="font-size:10px; color:#555; padding:4px;">æš‚æ— è®°å½•</div>';return`\n        <div class="card" style="display:flex; justify-content:space-between; align-items:center; background:rgba(255,255,255,0.1);">\n            <div style="font-size:16px; font-weight:700; color:#fff;">${n}</div>\n            <div style="font-size:11px; color:#aaa;">${a}</div>\n        </div>\n        <div class="card">\n            <div class="card-title">ç¤¾ä¼šå…³ç³»</div>\n            <div class="info-row"><span class="info-key">èŒä¸š</span><span class="info-val">${o}</span></div>\n            <div class="info-row"><span class="info-key">é…å¶</span><span class="info-val">${s}</span></div>\n            <div class="info-row"><span class="info-key">æƒ…äºº</span><span class="info-val">${r}</span></div>\n            <div class="info-row"><span class="info-key">å­å¥³</span><span class="info-val">${l}</span></div>\n        </div>\n        <div class="card">\n            <div class="card-title">ä¸ªäººçŠ¶å†µ</div>\n            <div class="info-row"><span class="info-key">ç°é‡‘</span><span class="info-val" style="color:#ddd; font-weight:700;">Â¥${c.toLocaleString()}</span></div>\n            <div class="info-row"><span class="info-key">åˆçº¦çŠ¶æ€</span><span class="info-val">${d}</span></div>\n            <div class="info-row"><span class="info-key">æŒæœ‰èµ„äº§</span><span class="info-val" style="font-size:10px; max-width:140px; text-align:right;">${v}</span></div>\n        </div>\n        <div class="card">\n            <div class="card-title">ä»£è¡¨ä½œå“</div>\n            ${u(f)}\n        </div>\n        <div class="card">\n            <div class="card-title">è£èª‰è®°å½•</div>\n            ${u(g)}\n        </div>`},business:t=>{const n=i(t,'å…¬å¸è´¦æˆ·._ç°é‡‘',0),e=i(t,'å…¬å¸è´¦æˆ·.å›ºå®šæˆæœ¬',{}),a=i(t,'å…¬å¸è´¦æˆ·.å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨',0),o=i(t,'å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®',{}),s='object'==typeof e&&null!==e&&Object.keys(e).map(t=>{const n=e[t];return`<div class="info-row">\n                <span class="info-key">${t}</span>\n                <span class="info-val">Â¥${('number'==typeof n?n:parseFloat(String(n))||0).toLocaleString()}/æœˆ</span>\n              </div>`}).join('')||'<div style="font-size:10px; color:#555; padding:4px;">æš‚æ— å›ºå®šæˆæœ¬</div>',r='object'==typeof o&&null!==o&&Object.keys(o).map(t=>{const n=o[t];if('object'==typeof n&&null!==n){const e='æœˆé”€é‡'in n?n.æœˆé”€é‡:0,a='å•ä»·'in n?n.å•ä»·:0,o='_æœˆæ¯›åˆ©'in n?n._æœˆæ¯›åˆ©:0,s='è¾¹é™…æˆæœ¬ç‡'in n?n.è¾¹é™…æˆæœ¬ç‡:.5;return`<div class="list-item project-item" data-project-name="${t.replace(/"/g,'&quot;')}" style="padding:4px 0;">\n                      <div style="flex:1;">\n                        <span class="hl-val">${t}</span>\n                        <div style="font-size:9px; color:#666; margin-top:2px;">\n                          é”€é‡: ${e.toLocaleString()} | å•ä»·: Â¥${a.toLocaleString()} | æˆæœ¬ç‡: ${(100*s).toFixed(0)}%\n                        </div>\n                      </div>\n                      <div style="display:flex; align-items:center; gap:8px;">\n                        <span class="dim-val" style="color:${o>=0?'#4a9':'#a44'};">\n                          ${o>=0?'+':''}Â¥${o.toLocaleString()}\n                        </span>\n                        <div class="project-actions">\n                          <span class="btn-small btn-edit-project" data-project-name="${t.replace(/"/g,'&quot;')}" title="ç¼–è¾‘">âœï¸</span>\n                          <span class="btn-small btn-delete-project" data-project-name="${t.replace(/"/g,'&quot;')}" title="åˆ é™¤">ğŸ—‘ï¸</span>\n                        </div>\n                      </div>\n                    </div>`}return null}).filter(Boolean).join('')||'<div style="font-size:10px; color:#555; padding:4px;">æš‚æ— è¿è¡Œé¡¹ç›®</div>';return`\n        <div class="card">\n            <div class="card-title" style="display:flex; justify-content:space-between; align-items:center;">\n                <span>èµ„äº§</span>\n                <span class="btn-small btn-recalculate-cash" title="é‡ç®—ç°é‡‘" style="cursor:pointer; padding:2px 6px; font-size:9px; background:rgba(74,169,74,0.3); border-radius:4px;">ğŸ”„ é‡ç®—ç°é‡‘</span>\n            </div>\n            <div class="info-row"><span class="info-key">ç°é‡‘</span><span class="info-val" style="color:#4a9; font-weight:700;">Â¥${n.toLocaleString()}</span></div>\n        </div>\n        <div class="card">\n            <div class="card-title">è¿è¡Œé¡¹ç›®</div>\n            ${r}\n            <div class="btn-add btn-add-project">+ æ–°å¢é¡¹ç›®</div>\n        </div>\n        <div class="card">\n            <div class="card-title">å›ºå®šæˆæœ¬</div>\n            ${s}\n        </div>\n        <div class="card">\n            <div class="card-title">å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨</div>\n            <div class="info-row">\n                <span class="info-key">ä¸€æ¬¡æ€§å˜åŠ¨</span>\n                <span class="info-val" style="color:${a>=0?'#4a9':'#a44'}; font-weight:${0!==a?'700':'500'};">\n                    ${a>=0?'+':''}Â¥${a.toLocaleString()}\n                </span>\n            </div>\n        </div>`},social:t=>{const n=i(t,'äººè„‰.ç¤¾äº¤ç‰ˆå›¾',[]),e=i(t,'äººè„‰.è¿‘æœŸäº’åŠ¨',[]),a=i(t,'äººè„‰.å…³ç³»ç°¿',{}),o=[];if('object'==typeof a&&null!==a)for(const t in a){const n='number'==typeof a[t]?a[t]:parseInt(String(a[t]))||0;o.push({name:t,v:n})}const s=o.filter(t=>t.v>30).sort((t,n)=>n.v-t.v),r=o.filter(t=>t.v<-30).sort((t,n)=>t.v-n.v),l=t=>t.length?t.map(t=>`<div class="list-item"><span class="hl-val">${t.name}</span><span class="dim-val">${t.v}</span></div>`).join(''):'<div style="font-size:10px; color:#555;">æ— </div>';return`\n        <div class="card">\n            <div class="card-title">ç¤¾äº¤ç‰ˆå›¾</div>\n            <div>${c=n,Array.isArray(c)&&c.length>0&&'æ— '!==c[0]?c.map(t=>`<span style="display:inline-block; background:rgba(255,255,255,0.1); padding:2px 5px; border-radius:3px; font-size:10px; margin-right:4px; margin-bottom:4px;">${t}</span>`).join(''):'<span style="color:#555; font-size:10px;">æ— </span>'}</div>\n        </div>\n        <div class="card">\n            <div class="card-title">è¿‘æœŸäº’åŠ¨</div>\n            <div>${(t=>Array.isArray(t)&&t.length>0&&'æ— '!==t[0]?t.map(t=>`<div style="font-size:10px; color:#ccc; margin-bottom:3px;">â€¢ ${t}</div>`).join(''):'<div style="font-size:10px; color:#555;">æ— </div>')(e)}</div>\n        </div>\n        <div class="card">\n            <div class="card-title">æ ¸å¿ƒç›Ÿå‹</div>\n            ${l(s)}\n        </div>\n        <div class="card">\n            <div class="card-title">æ½œåœ¨æ•Œå¯¹</div>\n            ${l(r)}\n        </div>`;var c},world:t=>`\n        <div class="card" style="text-align:center;">\n            <div style="font-size:14px; font-weight:700; color:#fff; margin-bottom:4px;">${i(t,'ä¸–ç•Œ.å½“å‰æ—¥æœŸ','å¾…å®š')}</div>\n            <div style="font-size:10px; color:#888;">ğŸ“ ${i(t,'ä¸–ç•Œ.å½“å‰åœ°ç‚¹','å¾…å®š')}</div>\n        </div>\n        <div class="card">\n            <div class="card-title">æ–°é—»åŠ¨æ€</div>\n            <div class="info-block"><b style="color:#888;">æ—¶ä»£:</b> ${i(t,'ä¸–ç•Œ.æ—¶ä»£æ–°é—»','æ— ')}</div>\n            <div class="info-block"><b style="color:#888;">è¡Œä¸š:</b> ${i(t,'ä¸–ç•Œ.è¡Œä¸šæ–°é—»','æ— ')}</div>\n            <div class="info-block"><b style="color:#888;">å…«å¦:</b> ${i(t,'ä¸–ç•Œ.å…«å¦æ–°é—»','æ— ')}</div>\n        </div>\n        <div class="card">\n            <div class="card-title">ä¸“ä¸šè¯„ä¼°</div>\n            <div class="info-row"><span class="info-key">å½“å‰å’–ä½</span><span class="info-val">${i(t,'ä¸“ä¸šè¯„ä¼°.å½“å‰å’–ä½','æ— ')}</span></div>\n            <div class="info-row"><span class="info-key">ä¸šåŠ¡èƒ½åŠ›</span><span class="info-val">${i(t,'ä¸“ä¸šè¯„ä¼°.ä¸šåŠ¡èƒ½åŠ›','æ— ')}</span></div>\n            <div class="info-row"><span class="info-key">åª’ä½“é£å‘</span><span class="info-val">${i(t,'ä¸“ä¸šè¯„ä¼°.åª’ä½“é£å‘','æ— ')}</span></div>\n            <div class="info-row"><span class="info-key">ç¤¾ä¼šé£è¯„</span><span class="info-val">${i(t,'ä¸“ä¸šè¯„ä¼°.ç¤¾ä¼šé£è¯„','æ— ')}</span></div>\n            <div class="info-row"><span class="info-key">ç²‰ä¸åŸºç¡€</span><span class="info-val">${i(t,'ä¸“ä¸šè¯„ä¼°.ç²‰ä¸åŸºç¡€','æ— ')}</span></div>\n        </div>`};function l(){$('head').append('\n<style id="fate-phone-css">\n    @import url(\'https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap\');\n    #fate-phone-container {\n        --phone-w: 95vw;\n        --max-w: 350px;\n        --phone-h: 80vh;\n        --max-h: 680px;\n        --bezel: 12px; --radius: 24px;\n        --c-frame: #111; --c-bg: #050505; --c-card: rgba(255,255,255,0.08); --c-text: #eee; --c-sub: #888;\n\n        position: fixed;\n        width: var(--phone-w); max-width: var(--max-w);\n        height: var(--phone-h); max-height: var(--max-h);\n\n        background: var(--c-frame); border-radius: var(--radius);\n        box-shadow: 0 0 0 2px #000, 0 0 0 4px #333, 0 20px 50px rgba(0,0,0,0.6);\n        z-index: 500; font-family: \'Noto Sans SC\', sans-serif; color: var(--c-text);\n        user-select: none; transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);\n    }\n    #fate-phone-container.collapsed {\n        width: 50px; height: 50px;\n        border-radius: 14px; border: 2px solid #555;\n        min-width: 0; min-height: 0;\n        overflow: hidden;\n    }\n    .icon-placeholder { display: none; width: 100%; height: 100%; align-items: center; justify-content: center; font-size: 20px; cursor: pointer; background: #000; }\n    #fate-phone-container.collapsed .icon-placeholder { display: flex; }\n    #fate-phone-container.collapsed .screen-area { display: none; }\n    .screen-area { position: absolute; top: var(--bezel); left: var(--bezel); right: var(--bezel); bottom: var(--bezel); background: linear-gradient(170deg, #1a1a1a 0%, #000 100%); border-radius: calc(var(--radius) - 4px); overflow: hidden; display: flex; flex-direction: column; pointer-events: auto; }\n    .status-bar { height: 24px; min-height: 24px; display: flex; align-items: center; justify-content: space-between; padding: 0 12px; font-size: 10px; z-index: 20; background: rgba(0,0,0,0.3); }\n    #fp-clock { cursor: pointer; font-weight: 700; color: #ddd; opacity: 0.8; transition: 0.2s; }\n    #fp-clock:hover { opacity: 1; color: #fff; }\n    .header-info { padding: 8px 15px 10px 15px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.08); background: rgba(0,0,0,0.2); }\n    .main-title { font-size: 16px; font-weight: 900; color: #fff; margin-bottom: 2px; letter-spacing: 1px; }\n    .sub-quote { font-size: 9px; color: #666; font-style: italic; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; opacity: 0.7; }\n    .scroll-content { flex: 1; overflow-y: auto; padding: 10px; scrollbar-width: none; cursor: grab; -webkit-overflow-scrolling: touch; }\n    .scroll-content.grabbing { cursor: grabbing; }\n    .scroll-content::-webkit-scrollbar { display: none; }\n    .nav-bar { height: 50px; min-height: 50px; background: rgba(15,15,15,0.98); border-top: 1px solid rgba(255,255,255,0.08); display: flex; justify-content: space-around; align-items: center; padding-bottom: 2px; }\n    .nav-item { flex: 1; height: 100%; display: flex; flex-direction: column; align-items: center; justify-content: center; font-size: 9px; color: #444; cursor: pointer; transition: 0.2s; }\n    .nav-item:hover { color: #888; background: rgba(255,255,255,0.02); }\n    .nav-item.active { color: #ddd; font-weight: 700; }\n    .nav-icon { font-size: 16px; margin-bottom: 2px; filter: grayscale(1); opacity: 0.5; transition: 0.2s; }\n    .nav-item.active .nav-icon { filter: grayscale(0); opacity: 1; }\n    .card { background: var(--c-card); border-radius: 8px; padding: 10px; margin-bottom: 10px; }\n    .card-title { font-size: 9px; color: #666; text-transform: uppercase; margin-bottom: 6px; font-weight: 700; letter-spacing: 1px; display: flex; align-items: center; gap: 6px; }\n    .card-title::before { content:\'\'; display:block; width:3px; height:8px; background:#444; }\n    .info-row { display: flex; justify-content: space-between; align-items: center; padding: 3px 0; font-size: 11px; border-bottom: 1px solid rgba(255,255,255,0.03); }\n    .info-row:last-child { border-bottom: none; }\n    .info-key { color: #888; }\n    .info-val { color: #eee; font-weight: 500; text-align: right; }\n    .info-block { margin-top: 6px; padding: 6px; background: rgba(0,0,0,0.3); border-radius: 6px; font-size: 11px; color: #ccc; line-height: 1.4; }\n    .btn-icon { cursor: pointer; padding: 4px; opacity: 0.6; transition: 0.2s; font-size: 12px; }\n    .btn-icon:hover { opacity: 1; }\n    .list-item { padding: 5px 0; border-bottom: 1px solid rgba(255,255,255,0.03); font-size: 11px; display: flex; justify-content: space-between; }\n    .list-item:last-child { border-bottom: none; }\n    .hl-val { color: #fff; font-weight: 600; }\n    .dim-val { color: #666; font-size: 10px; }\n    .project-actions { display: flex; gap: 6px; align-items: center; }\n    .btn-small { cursor: pointer; padding: 2px 6px; font-size: 9px; background: rgba(255,255,255,0.1); border-radius: 4px; transition: 0.2s; }\n    .btn-small:hover { background: rgba(255,255,255,0.2); }\n    .btn-add { cursor: pointer; padding: 6px 12px; font-size: 10px; background: rgba(74,169,74,0.3); border-radius: 6px; text-align: center; margin-top: 8px; transition: 0.2s; }\n    .btn-add:hover { background: rgba(74,169,74,0.5); }\n    .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.7); z-index: 10000; display: none; align-items: center; justify-content: center; }\n    .modal-overlay.show { display: flex; }\n    .modal-content { background: #1a1a1a; border-radius: 12px; padding: 20px; max-width: 400px; width: 90%; border: 1px solid rgba(255,255,255,0.1); }\n    .modal-title { font-size: 14px; font-weight: 700; color: #fff; margin-bottom: 15px; }\n    .form-group { margin-bottom: 12px; }\n    .form-label { font-size: 10px; color: #888; margin-bottom: 4px; display: block; }\n    .form-input { width: 100%; padding: 8px; background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.1); border-radius: 6px; color: #fff; font-size: 11px; box-sizing: border-box; }\n    .form-input:focus { outline: none; border-color: rgba(74,169,74,0.5); }\n    .modal-actions { display: flex; gap: 10px; justify-content: flex-end; margin-top: 15px; }\n    .btn-modal { padding: 8px 16px; border-radius: 6px; font-size: 11px; cursor: pointer; transition: 0.2s; border: none; }\n    .btn-modal-primary { background: rgba(74,169,74,0.5); color: #fff; }\n    .btn-modal-primary:hover { background: rgba(74,169,74,0.7); }\n    .btn-modal-secondary { background: rgba(255,255,255,0.1); color: #ccc; }\n    .btn-modal-secondary:hover { background: rgba(255,255,255,0.2); }\n</style>\n'),$('body').prepend('\n<div id="fate-phone-container">\n    <div class="icon-placeholder">ğŸ“±</div>\n    <div class="screen-area">\n        <div class="status-bar">\n            <span id="fp-clock">12:00</span>\n            <div style="display:flex; gap:10px;">\n                <div id="btn-bgm" class="btn-icon">ğŸ”‡</div>\n                <div id="btn-collapse" class="btn-icon">â–¼</div>\n            </div>\n        </div>\n        <div class="header-info">\n            <div id="fp-title" class="main-title">é€æ¢¦æ¼”è‰ºåœˆ</div>\n            <div id="fp-quote" class="sub-quote">...</div>\n        </div>\n        <div id="fp-content" class="scroll-content"></div>\n        <div class="nav-bar">\n            <div class="nav-item" data-tab="home"><div class="nav-icon">ğŸ‘¤</div><div>æ¡£æ¡ˆ</div></div>\n            <div class="nav-item" data-tab="business"><div class="nav-icon">ğŸ’¼</div><div>å•†ä¸š</div></div>\n            <div class="nav-item" data-tab="social"><div class="nav-icon">ğŸ•¸ï¸</div><div>äººè„‰</div></div>\n            <div class="nav-item" data-tab="world"><div class="nav-icon">ğŸ‘ï¸</div><div>æƒ…æŠ¥</div></div>\n        </div>\n    </div>\n</div>\n');$('body').append('\n    <div id="project-modal" class="modal-overlay">\n      <div class="modal-content">\n        <div class="modal-title" id="modal-title">æ–°å¢è¿è¡Œé¡¹ç›®</div>\n        <div class="form-group">\n          <label class="form-label">é¡¹ç›®åç§°</label>\n          <input type="text" id="modal-project-name" class="form-input" placeholder="è¯·è¾“å…¥é¡¹ç›®åç§°" />\n        </div>\n        <div class="form-group">\n          <label class="form-label">æœˆé”€é‡</label>\n          <input type="number" id="modal-monthly-sales" class="form-input" placeholder="0" min="0" step="1" />\n        </div>\n        <div class="form-group">\n          <label class="form-label">å•ä»· (Â¥)</label>\n          <input type="number" id="modal-price" class="form-input" placeholder="0" min="0" step="0.01" />\n        </div>\n        <div class="form-group">\n          <label class="form-label">è¾¹é™…æˆæœ¬ç‡ (0-1)</label>\n          <input type="number" id="modal-cost-rate" class="form-input" placeholder="0.5" min="0" max="1" step="0.01" />\n        </div>\n        <div class="modal-actions">\n          <button class="btn-modal btn-modal-secondary" id="modal-cancel">å–æ¶ˆ</button>\n          <button class="btn-modal btn-modal-primary" id="modal-save">ä¿å­˜</button>\n        </div>\n      </div>\n    </div>\n  ');const t=$('#fate-phone-container'),n=$('#fp-content'),l=()=>{const n=o[s.posIndex];t.css({top:'auto',bottom:'auto',left:'auto',right:'auto'}),t.css(n.css)};l();const c=()=>{const n=function(){try{if(window.Mvu&&'function'==typeof window.Mvu.getMvuData){const t=window.Mvu.getMvuData({type:'message',message_id:'latest'});if(t&&t.stat_data)return e.parse(t.stat_data)}}catch(t){console.warn('è·å– MVU æ•°æ®å¤±è´¥:',t)}return e.parse({})}();$('#fp-title').text('é€æ¢¦æ¼”è‰ºåœˆ'),$('#fp-quote').text('åœ¨å¨±ä¹åœˆçš„æµ®æ²‰ä¸­å¯»æ‰¾è‡ªå·±çš„ä½ç½®');const a=i(n,'ä¸–ç•Œ.å½“å‰æ—¥æœŸ','å¾…å®š').match(/(\d{2}:\d{2})/);$('#fp-clock').text(a?a[1]:'12:00');const o=$('#btn-bgm');o.text(s.isBgmOn?'ğŸ”Š':'ğŸ”‡'),o.css('opacity',s.isBgmOn?'1':'0.5'),s.isCollapsed?t.addClass('collapsed'):t.removeClass('collapsed');const l=r[s.currentTab]||r.home;$('#fp-content').html(l(n)),$('.nav-item').removeClass('active'),$(`.nav-item[data-tab="${s.currentTab}"]`).addClass('active')},d=window.fateAudioInstance;$(document).one('click',function(){s.isBgmOn&&d.paused&&d.play()}),t.on('click','.nav-item',function(t){t.stopPropagation(),s.currentTab=$(this).data('tab'),localStorage.setItem(window.FATE_CONFIG.storageTab,s.currentTab),c()});t.on('click','#btn-collapse, .icon-placeholder',t=>{t.stopPropagation(),s.isCollapsed=!s.isCollapsed,localStorage.setItem(window.FATE_CONFIG.storageCollapse,String(s.isCollapsed)),c()}),t.on('click','#btn-bgm',function(t){t.stopPropagation(),s.isBgmOn=!s.isBgmOn,c(),s.isBgmOn?d.play().catch(()=>{}):d.pause()});let p=null;const v=t=>{t.stopPropagation(),t.preventDefault(),p&&clearTimeout(p),p=setTimeout(()=>{s.posIndex=(s.posIndex+1)%o.length,localStorage.setItem(window.FATE_CONFIG.storagePosIndex,String(s.posIndex)),l(),p=null},150)};t.on('click','#fp-clock',v),t.on('touchstart','#fp-clock',function(t){t.stopPropagation()}),t.on('touchend','#fp-clock',function(t){t.stopPropagation(),v(t)});const f=t=>{const n=$('#project-modal'),a=!!t;if($('#modal-title').text(a?'ç¼–è¾‘è¿è¡Œé¡¹ç›®':'æ–°å¢è¿è¡Œé¡¹ç›®'),$('#modal-project-name').val(t||''),$('#modal-project-name').prop('disabled',a),a)try{const n=window.Mvu.getMvuData({type:'message',message_id:'latest'}),a=e.parse(_.get(n,'stat_data',{})),o=a.å…¬å¸è´¦æˆ·?.è¿è¡Œé¡¹ç›®;if(o&&'object'==typeof o&&t){const n=o[t];n&&'object'==typeof n&&($('#modal-monthly-sales').val(n.æœˆé”€é‡||0),$('#modal-price').val(n.å•ä»·||0),$('#modal-cost-rate').val(n.è¾¹é™…æˆæœ¬ç‡||.5))}}catch(t){console.warn('è·å–é¡¹ç›®æ•°æ®å¤±è´¥:',t)}else $('#modal-monthly-sales').val(''),$('#modal-price').val(''),$('#modal-cost-rate').val('0.5');n.addClass('show')},g=()=>{$('#project-modal').removeClass('show')},u=async()=>{const t=String($('#modal-project-name').val()||'').trim();if(!t)return void toastr.warning('è¯·è¾“å…¥é¡¹ç›®åç§°');const n=parseFloat(String($('#modal-monthly-sales').val()||'0')),a=parseFloat(String($('#modal-price').val()||'0')),o=parseFloat(String($('#modal-cost-rate').val()||'0.5'));if(isNaN(n)||isNaN(a)||isNaN(o))toastr.warning('è¯·è¾“å…¥æœ‰æ•ˆçš„æ•°å€¼');else if(o<0||o>1)toastr.warning('è¾¹é™…æˆæœ¬ç‡å¿…é¡»åœ¨0-1ä¹‹é—´');else try{const s=window.Mvu.getMvuData({type:'message',message_id:'latest'}),i=e.parse(_.get(s,'stat_data',{}));i.å…¬å¸è´¦æˆ·||(i.å…¬å¸è´¦æˆ·={è¿è¡Œé¡¹ç›®:{},å›ºå®šæˆæœ¬:{äººåŠ›æˆæœ¬:0,æˆ¿ç§Ÿ:0},å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨:0,_ç°é‡‘:0}),i.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®||(i.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®={});const r=n*a*(1-o);i.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®[t]={æœˆé”€é‡:n,å•ä»·:a,è¾¹é™…æˆæœ¬ç‡:_.clamp(o,0,1),_æœˆæ¯›åˆ©:r},_.set(s,'stat_data',i),await window.Mvu.replaceMvuData(s,{type:'message',message_id:'latest'}),g(),c(),toastr.success('ä¿å­˜æˆåŠŸ')}catch(t){console.error('ä¿å­˜é¡¹ç›®å¤±è´¥:',t),toastr.error('ä¿å­˜å¤±è´¥: '+(t instanceof Error?t.message:String(t)))}},m=async()=>{try{const t=window.Mvu.getMvuData({type:'message',message_id:'latest'}),n=e.parse(_.get(t,'stat_data',{}));let o;try{o=window.Mvu.getMvuData({type:'message',message_id:-2})}catch(n){o=t}const s=_.get(o,'stat_data',{}),i=_.get(s,'ä¸–ç•Œ.å½“å‰æ—¥æœŸ'),r=_.get(n,'ä¸–ç•Œ.å½“å‰æ—¥æœŸ'),l=_.get(s,'å…¬å¸è´¦æˆ·._ç°é‡‘',0),d=_.get(n,'å…¬å¸è´¦æˆ·.å…¬è´¦ä¸€æ¬¡æ€§å˜åŠ¨',0),p=_.get(s,'å…¬å¸è´¦æˆ·.å›ºå®šæˆæœ¬',{}),v=_.get(s,'å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®',{});if(i&&r&&'å¾…å®š'!==i&&'å¾…å®š'!==r){const e=function(t,n){const e=a(t),o=a(n);if(!e||!o)return 0;if(o<=e)return 0;const s=e.getFullYear(),i=e.getMonth(),r=e.getDate(),l=o.getFullYear(),c=o.getMonth();let d=s,p=i;r>1&&(p++,p>11&&(p=0,d++));let v=0;for(;!(d>l||d===l&&p>c);){if(d===l&&p===c){v++;break}v++,p++,p>11&&(p=0,d++)}return v}(i,r),o=function(t,n,e,a,o){let s=Number(t)||0;if(s+=Number(n)||0,e>=1){const t=(Number(_.get(a,'äººåŠ›æˆæœ¬'))||0)+(Number(_.get(a,'æˆ¿ç§Ÿ'))||0);let n=0;if(o&&'object'==typeof o)for(const t in o){const e=o[t];e&&'object'==typeof e&&'_æœˆæ¯›åˆ©'in e&&(n+=Number(e._æœˆæ¯›åˆ©)||0)}s-=t*e,s+=n*e}return s}(l,d,e,p,v);_.set(n,'å…¬å¸è´¦æˆ·._ç°é‡‘',o),_.set(t,'stat_data',n),await window.Mvu.replaceMvuData(t,{type:'message',message_id:'latest'});const s=Number(_.get(p,'äººåŠ›æˆæœ¬'))||0,f=s+(Number(_.get(p,'æˆ¿ç§Ÿ'))||0);let g=0;if(v&&'object'==typeof v)for(const t in v){const n=v[t];n&&'object'==typeof n&&'_æœˆæ¯›åˆ©'in n&&(g+=Number(n._æœˆæ¯›åˆ©)||0)}let u=`ç°é‡‘é‡ç®—å®Œæˆï¼\næ—§ç°é‡‘: Â¥${l.toLocaleString()}\næ–°ç°é‡‘: Â¥${o.toLocaleString()}`;e>0&&(u+=`\nè·¨æœˆæ•°: ${e}\nå›ºå®šæˆæœ¬: Â¥${f.toLocaleString()}/æœˆ\næœˆæ¯›åˆ©æ€»å’Œ: Â¥${g.toLocaleString()}/æœˆ`),toastr.success(u,'é‡ç®—ç°é‡‘',{timeOut:5e3}),c()}else{const e=_.get(n,'å…¬å¸è´¦æˆ·._ç°é‡‘',0),a=e+d;_.set(n,'å…¬å¸è´¦æˆ·._ç°é‡‘',a),_.set(t,'stat_data',n),await window.Mvu.replaceMvuData(t,{type:'message',message_id:'latest'}),toastr.success(`ç°é‡‘é‡ç®—å®Œæˆï¼\nå½“å‰ç°é‡‘: Â¥${e.toLocaleString()}\nä¸€æ¬¡æ€§å˜åŠ¨: ${d>=0?'+':''}Â¥${d.toLocaleString()}\næ–°ç°é‡‘: Â¥${a.toLocaleString()}`,'é‡ç®—ç°é‡‘',{timeOut:5e3}),c()}}catch(t){console.error('é‡ç®—ç°é‡‘å¤±è´¥:',t),toastr.error('é‡ç®—ç°é‡‘å¤±è´¥: '+(t instanceof Error?t.message:String(t)))}};t.on('click','.btn-add-project',function(t){t.stopPropagation(),f()}),t.on('click','.btn-edit-project',function(t){t.stopPropagation();const n=$(this).data('project-name');n&&f(n)}),t.on('click','.btn-delete-project',function(t){t.stopPropagation();const n=$(this).data('project-name');n&&(async t=>{if(confirm(`ç¡®å®šè¦åˆ é™¤é¡¹ç›®"${t}"å—ï¼Ÿ`))try{const n=window.Mvu.getMvuData({type:'message',message_id:'latest'}),a=e.parse(_.get(n,'stat_data',{}));a.å…¬å¸è´¦æˆ·?.è¿è¡Œé¡¹ç›®&&t in a.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®&&(delete a.å…¬å¸è´¦æˆ·.è¿è¡Œé¡¹ç›®[t],_.set(n,'stat_data',a),await window.Mvu.replaceMvuData(n,{type:'message',message_id:'latest'}),c(),toastr.success('åˆ é™¤æˆåŠŸ'))}catch(t){console.error('åˆ é™¤é¡¹ç›®å¤±è´¥:',t),toastr.error('åˆ é™¤å¤±è´¥: '+(t instanceof Error?t.message:String(t)))}})(n)}),t.on('click','.btn-recalculate-cash',function(t){t.stopPropagation(),m()}),$('#modal-cancel, #project-modal').on('click',function(t){t.target===this&&g()}),$('#modal-save').on('click',function(t){t.stopPropagation(),u()}),$('#project-modal input').on('keydown',function(t){'Enter'===t.key&&(t.preventDefault(),u())});let b,x,y=!1;const h=t=>{y=!0,n.addClass('grabbing'),b=t-n.offset().top,x=n.scrollTop()},w=t=>{if(!y)return;const e=1.5*(t-n.offset().top-b);n.scrollTop(x-e)},k=()=>{y=!1,n.removeClass('grabbing')};n.on('mousedown',t=>h(t.pageY)),n.on('mouseleave',k),n.on('mouseup',k),n.on('mousemove',t=>{y&&(t.preventDefault(),w(t.pageY))}),n.on('touchstart',t=>h(t.originalEvent.touches[0].pageY)),n.on('touchend',k),n.on('touchmove',t=>{y&&w(t.originalEvent.touches[0].pageY)}),c();let j=0;const I=setInterval(()=>{c(),j++,j>6&&clearInterval(I)},500);let M=null;const S=()=>{M&&clearTimeout(M),M=setTimeout(()=>{c(),M=null},500)};if(window.eventOn){window.tavern_events&&eventOn(tavern_events.MESSAGE_RECEIVED,S),window.Mvu&&Mvu.events&&eventOn(Mvu.events.VARIABLE_UPDATE_ENDED,S);try{window.parent&&window.parent.eventOn&&window.parent.Mvu&&window.parent.eventOn(window.parent.Mvu.events.VARIABLE_UPDATE_ENDED,S)}catch(t){}}}$(errorCatched(async()=>{await waitGlobalInitialized('Mvu'),await t(()=>{try{if(window.Mvu&&'function'==typeof window.Mvu.getMvuData){const t=window.Mvu.getMvuData({type:'message',message_id:'latest'});return t&&_.has(t,'stat_data')}}catch(t){return!1}return!1});const n=setInterval(()=>{window.jQuery&&(clearInterval(n),l())},200)})),$(window).on('pagehide',()=>{$('#fate-phone-container, #fate-phone-css, #project-modal').remove(),$(document).off('.fatephone')});
//# sourceMappingURL=index.js.map